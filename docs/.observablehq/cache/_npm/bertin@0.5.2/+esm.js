/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/bertin@0.5.2/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as t from"../d3-selection@3.0.0/+esm.js";import*as e from"../d3-geo@3.1.0/+esm.js";import*as l from"../d3-geo-projection@4.0.0/+esm.js";import*as r from"../d3-shape/+esm.js";import*as a from"../d3-force@3.0.0/+esm.js";import*as o from"../d3-scale@4.0.2/+esm.js";import*as i from"../d3-array@3.2.4/+esm.js";import*as n from"../d3-scale-chromatic/+esm.js";import*as s from"../statsbreaks@0.1.4/+esm.js";import*as c from"../topojson-server@3.0.1/+esm.js";import*as p from"../topojson-client@3.1.0/+esm.js";import*as g from"../d3-geo-scale-bar@1.2.5/+esm.js";import f from"../proj4@2.10.0/+esm.js";const d=Object.assign({},t,e,l);const h=Object.assign({},t,e,l);function y(t,e,l={}){let r=l.fill?l.fill:"#add8f7",a=l.fillOpacity?l.fillOpacity:1,o=l.stroke?l.stroke:"none",i=l.strokeWidth?l.strokeWidth:1;t.append("g").attr(":inkscape:groupmode","layer").attr("id","outline").attr(":inkscape:label","outline").append("path").attr("d",h.geoPath(e)({type:"Sphere"})).attr("fill",r).attr("fill-opacity",a).attr("stroke",o).attr("stroke-width",i)}function _(t){let e=["z","l","p"],l=t.features.map((t=>t.geometry.type));l=Array.from(new Set(l));let r=(-1!==l.indexOf("Polygon")||-1!==l.indexOf("MultiPolygon")?e[0]:"")+(-1!==l.indexOf("LineString")||-1!==l.indexOf("MultiLineString")?e[1]:"")+(-1!==l.indexOf("Point")||-1!==l.indexOf("MultiPoint")?e[2]:"");return 1==r.length?r:"composite"}function k(t,e){if(!e)return t.style("display","none");t.style("display",null).style("pointer-events","none").style("font","8px sans-serif");const l=t.selectAll("path").data([null]).join("path").attr("fill","#fcf7e6").attr("stroke","#4a4d4b"),r=["bold","normal","normal"],a=[18,14,10],o=["normal","normal","italic"],i=t.selectAll("text").data([null]).join("text").call((t=>t.selectAll("tspan").data((e+"").split(/\n/)).join("tspan").attr("x",0).attr("y",((t,e)=>1.4*e+"em")).style("font-weight",((t,e)=>r[e])).style("font-size",((t,e)=>a[e])).style("font-style",((t,e)=>o[e])).style("fill","#4d4545").text((t=>t)))),{x:n,y:s,width:c,height:p}=i.node().getBBox();i.attr("transform",`translate(${-c/2},${15-s})`),l.attr("d",`M${-c/2-10},5H-5l5,-5l5,5H${c/2+10}v${p+20}h-${c+20}z`)}function m(t,e={}){let l=e.x?e.x:null,r=e.y?e.y:null,a=e.w?e.w:30,o=e.h?e.h:20,i=e.title?e.title:null,n=e.text?e.text:"text of the box",s=e.fontSize?e.fontSize:14,c=e.fontSize2?e.fontSize2:10,p=e.stroke?e.stroke:"black",g=e.fill?e.fill:"#CCCCCC",f=e.fillOpacity?e.fillOpacity:1,d=e.strokeWidth?e.strokeWidth:.5,h=e.txtcol?e.txtcol:"#363636";if(null!=l&&null!=r){let e=t.append("g"),y=0;null!=i&&(y=(i.split("\n").length+1)*s,e.append("g").selectAll("text").data(i.split("\n")).join("text").attr("x",l).attr("y",r).attr("font-size",`${s}px`).attr("dy",((t,e)=>e*s)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",h).text((t=>t))),e.append("rect").attr("x",l).attr("y",r+y).attr("height",o).attr("width",a).attr("fill",g).attr("stroke",p).attr("stroke-width",d).attr("fill-opacity",f),e.append("g").selectAll("text").data(n.split("\n")).join("text").attr("x",l+a+c/2).attr("y",r+o/2-c*n.split("\n").length/2+y).attr("font-size",`${c}px`).attr("dy",((t,e)=>e*c)).attr("fill",h).attr("text-anchor","start").attr("alignment-baseline","hanging").text((t=>t))}}Object.assign({},t),Object.assign({},t),Object.assign({},t),Object.assign({},o,t);const x=Object.assign({},t,e,r,l,a);const u=Object.assign({},i,o,t);function b(t,e={}){let l=e.values,r=e.k?e.k:50,a=e.stroke?e.stroke:"black",o=e.fill?e.fill:"none",i=e.strokeWidth?e.strokeWidth:.8,n=e.txtcol?e.txtcol:"#363636",s=e.x?e.x:null,c=e.y?e.y:null,p=e.title?e.title:"Title, year\n(units)",g=e.fontSize?e.fontSize:14,f=e.fontSize2?e.fontSize2:10,d=e.round?e.round:void 0,h=u.scaleSqrt([0,u.max(l)],[0,r]),y=h(u.max(l));if(null!=s&&null!=c){let e=t.append("g");e.selectAll("circle").data(l.sort(u.descending)).join("circle").attr("r",(t=>h(t))).attr("fill",o).attr("stroke",a).attr("stroke-width",i).attr("transform",(t=>`translate(${s+y},${c-h(t)+2*y+(p.split("\n").length+1)*g})`)),e.selectAll("line").data(l).join("line").attr("x1",s+y).attr("y1",(t=>c+2*y-2*h(t)+(p.split("\n").length+1)*g)).attr("x2",s+2*y+g).attr("y2",(t=>c+2*y-2*h(t)+(p.split("\n").length+1)*g)).attr("stroke",a).attr("stroke-width",i).attr("stroke-dasharray",2),e.append("g").selectAll("text").data(p.split("\n")).join("text").attr("x",s).attr("y",c).attr("font-size",`${g}px`).attr("dy",((t,e)=>e*g)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",n).text((t=>t)),e.append("g").selectAll("text").data(l).join("text").attr("x",s+2*y+g+f/2).attr("y",(t=>c+2*y-2*h(t)+(p.split("\n").length+1)*g)).attr("font-size",f).attr("alignment-baseline","central").attr("fill",n).text((t=>void 0!==d||0!==d?t.toFixed(d):t))}}const w=Object.assign({},e);function z(t,e=!0){t=JSON.parse(JSON.stringify(t));return t.features.map((t=>(t.geometry.coordinates=w.geoCentroid(1==e?"Polygon"==t.geometry.type?t:function(t){var e={},l=0;return t.geometry.coordinates.forEach((function(t){var r={type:"Polygon",coordinates:t},a=w.geoArea(r);a>l&&(l=a,e=r)})),e}(t):t),t.geometry.type="Point",t)))}const O=Object.assign({},t,i,o,e,l);const S=Object.assign({},i,o,t);const j=Object.assign({},t,n,i,e,o);function $(t,e,l,r={}){let a=r.geojson,o=r.values,i=r.colors?r.colors:null,n=r.pal?r.pal:"Tableau10",s=r.col_missing?r.col_missing:"#f5f5f5",c=r.stroke?r.stroke:"white",p=r.strokeWidth?r.strokeWidth:.5,g=r.fillOpacity?r.fillOpacity:1,f=r.tooltip?r.tooltip:"",d=r.leg_x?r.leg_x:null,h=r.leg_y?r.leg_y:null,y=r.leg_w?r.leg_w:30,_=r.leg_h?r.leg_h:20,m=r.leg_title?r.leg_title:null,x=r.leg_fontSize?r.leg_fontSize:14,u=r.leg_fontSize2?r.leg_fontSize2:10,b=r.leg_stroke?r.leg_stroke:"black",w=r.fillOpacity?r.fillOpacity:1,z=r.leg_strokeWidth?r.leg_strokeWidth:.5,O=r.leg_txtcol?r.leg_txtcol:"#363636",$=Array.from(new Set(a.features.map((t=>t.properties[o]))));i=null==i?j[`scheme${n}`].slice(0,$.length):i.slice(0,$.length);let v=j.scaleOrdinal().domain($).range(i),W=j.geoPath(e);t.append("g").attr(":inkscape:groupmode","layer").attr("id","typo layer").attr(":inkscape:label","typo layer").selectAll("path").data(a.features).join("path").attr("d",W).attr("fill",(t=>t.properties[o]?v(t.properties[o]):s)).attr("stroke",c).attr("stroke-width",p).attr("fill-opacity",g).attr("clip-path",`url(#clip_${l}`).on("touchmove mousemove",(function(e,l){""!=f&&(Array.isArray(f)?t.select("#info").call(k,`${l.properties[f[0]]}\n${l.properties[f[1]]}\n${f[2]}`):t.select("#info").call(k,`${l.properties[f]}`)),""!=f&&(t.select("#info").attr("transform",`translate(${j.pointer(e,this)})`),j.select(this).attr("stroke-width",p+.5).attr("fill-opacity",g-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),j.select(this).attr("stroke-width",p).attr("fill-opacity",g)})),function(t,e={}){let l=e.x?e.x:null,r=e.y?e.y:null,a=e.w?e.w:30,o=e.h?e.h:20,i=e.title?e.title:null,n=e.fontSize?e.fontSize:14,s=e.fontSize2?e.fontSize2:10,c=e.stroke?e.stroke:"black",p=e.fillOpacity?e.fillOpacity:1,g=e.strokeWidth?e.strokeWidth:.5,f=e.txtcol?e.txtcol:"#363636",d=e.types,h=e.colors,y=S.scaleOrdinal().domain(d).range(h);if(null!=l&&null!=r){let e=t.append("g"),h=0;null!=i&&(h=(i.split("\n").length+1)*n,e.append("g").selectAll("text").data(i.split("\n")).join("text").attr("x",l).attr("y",r).attr("font-size",`${n}px`).attr("dy",((t,e)=>e*n)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",f).text((t=>t))),e.selectAll("rect").data(d).join("rect").attr("x",l).attr("y",((t,e)=>r+h+(o+3)*e)).attr("height",o).attr("width",a).attr("fill",(t=>y(t))).attr("stroke",c).attr("stroke-width",g).attr("fill-opacity",p),e.append("g").selectAll("text").data(d).join("text").attr("x",l+a+s/2).attr("y",r+h+o/2).attr("font-size",`${s}px`).attr("dy",((t,e)=>(o+3)*e)).attr("text-anchor","start").attr("alignment-baseline","central").text((t=>t))}}(t,{x:d,y:h,w:y,h:_,stroke:b,fillOpacity:w,strokeWidth:z,txtcol:O,title:m||o,fontSize:x,fontSize2:u,types:$,colors:i})}const v=Object.assign({},i,o,t);const W=Object.assign({},t,n,i,e,o);function A(t,e,l,r={}){let a=r.geojson,o=r.values,i=r.pal?r.pal:"Blues",n=r.nbreaks?r.nbreaks:5,c=r.breaks?r.breaks:null,p=r.colors?r.colors:null,g=r.method?r.method:"quantile",f=r.col_missing?r.col_missing:"#f5f5f5",d=r.stroke?r.stroke:"white",h=r.strokeWidth?r.strokeWidth:.5,y=r.fillOpacity?r.fillOpacity:1,_=r.tooltip?r.tooltip:"",m=r.leg_x?r.leg_x:null,x=r.leg_y?r.leg_y:null,u=r.leg_w?r.leg_w:30,b=r.leg_h?r.leg_h:20,w=r.leg_title?r.leg_title:null,z=r.leg_fontSize?r.leg_fontSize:14,O=r.leg_fontSize2?r.leg_fontSize2:10,S=r.leg_stroke?r.leg_stroke:"black",j=r.fillOpacity?r.fillOpacity:1,$=r.leg_strokeWidth?r.leg_strokeWidth:.5,A=r.leg_txtcol?r.leg_txtcol:"#363636",M=void 0!==r.leg_round?r.leg_round:void 0;"q6"==g&&(n=6),c=null==c?s.breaks({values:a.features.map((t=>+t.properties[o])),method:g,nb:n,precision:M}):W.sort(c),null==p&&(p=W[`scheme${i}`][n]);let C=[...c];C.pop(),C.shift();let P=W.scaleThreshold(C,p),D=W.geoPath(e);t.append("g").attr(":inkscape:groupmode","layer").attr("id","choro layer").attr(":inkscape:label","choro layer").selectAll("path").data(a.features).join("path").attr("d",D).attr("fill",(t=>t.properties[o]?P(t.properties[o]):f)).attr("stroke",d).attr("stroke-width",h).attr("fill-opacity",y).attr("clip-path",`url(#clip_${l}`).on("touchmove mousemove",(function(e,l){""!=_&&(Array.isArray(_)?t.select("#info").call(k,`${l.properties[_[0]]}\n${l.properties[_[1]]}\n${_[2]}`):t.select("#info").call(k,`${l.properties[_]}`)),""!=_&&(t.select("#info").attr("transform",`translate(${W.pointer(e,this)})`),W.select(this).attr("stroke-width",h+.5).attr("fill-opacity",y-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),W.select(this).attr("stroke-width",h).attr("fill-opacity",y)})),function(t,e={}){let l=e.x?e.x:null,r=e.y?e.y:null,a=e.w?e.w:30,o=e.h?e.h:20,i=e.title?e.title:null,n=e.fontSize?e.fontSize:14,s=e.fontSize2?e.fontSize2:10,c=e.stroke?e.stroke:"black",p=e.fillOpacity?e.fillOpacity:1,g=e.strokeWidth?e.strokeWidth:.5,f=e.txtcol?e.txtcol:"#363636",d=e.breaks,h=e.colors;if(null!=l&&null!=r){let e=t.append("g"),y=0;null!=i&&(y=(i.split("\n").length+1)*n,e.append("g").selectAll("text").data(i.split("\n")).join("text").attr("x",l).attr("y",r).attr("font-size",`${n}px`).attr("dy",((t,e)=>e*n)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",f).text((t=>t))),e.selectAll("rect").data(v.reverse(h)).join("rect").attr("x",l).attr("y",((t,e)=>r+y+(o+0)*e)).attr("height",o).attr("width",a).attr("fill",(t=>t)).attr("stroke",c).attr("stroke-width",g).attr("fill-opacity",p),e.append("g").selectAll("text").data(v.reverse(d)).join("text").attr("x",l+a+s/2).attr("y",r+y).attr("font-size",`${s}px`).attr("dy",((t,e)=>(o+0)*e)).attr("text-anchor","start").attr("alignment-baseline","central").text((t=>t))}}(t,{x:m,y:x,w:u,h:b,stroke:S,fillOpacity:j,strokeWidth:$,txtcol:A,title:w||o,fontSize:z,fontSize2:O,breaks:c,colors:p})}const M=Object.assign({},t,i,o,e,l);const C=Object.assign({},t,e,l);const P=Object.assign({},t,e,l);Object.assign({},t,e,l);const D=Object.assign({},t,e,l),F=Object.assign({},c,p);const E=Object.assign({},t,g);Object.assign({},t),Object.assign({},t);const B=Object.assign({},t,i,o,e,l);function q(t,e,l,r={}){let a=r.geojson,o=r.values,i=void 0!==r.k?r.k:50,n=void 0!==r.w?r.w:10,s=r.fill?r.fill:"#a31d88",c=r.stroke?r.stroke:"#a31d88",p=r.strokeWidth?r.strokeWidth:.7,g=r.fillOpacity?r.fillOpacity:.3,f=r.tooltip?r.tooltip:"",d=r.leg_x?r.leg_x:null,h=r.leg_y?r.leg_y:null;!r.leg_w||r.leg_w,!r.leg_h||r.leg_h;let y=r.leg_title?r.leg_title:null,m=r.leg_fontSize?r.leg_fontSize:14,x=r.leg_fontSize2?r.leg_fontSize2:10;!r.leg_stroke||r.leg_stroke,!r.fillOpacity||r.fillOpacity,!r.leg_strokeWidth||r.leg_strokeWidth;let u,b=r.leg_txtcol?r.leg_txtcol:"#363636",w=void 0!==r.leg_round?r.leg_round:void 0;u="p"==_(a)?a.features:z(a);const O=B.scaleLinear().domain([0,B.max(u.map((t=>+t.properties[o])))]).range([0,i]);t.append("g").selectAll("path").data(u.filter((t=>null!=t.geometry.coordinates)).filter((t=>null!=t.properties[o])).sort(((t,e)=>B.descending(+t.properties[o],+e.properties[o])))).join("path").attr("fill",s).attr("stroke",c).attr("stroke-width",p).attr("fill-opacity",g).attr("d",(t=>`M ${e(t.geometry.coordinates)[0]-n/2}, ${e(t.geometry.coordinates)[1]} ${e(t.geometry.coordinates)[0]}, ${e(t.geometry.coordinates)[1]-O(t.properties[o])} ${e(t.geometry.coordinates)[0]+n/2}, ${e(t.geometry.coordinates)[1]}`)).attr("clip-path",`url(#clip_${l}_rectangle)`).on("touchmove mousemove",(function(e,l){""!=f&&(Array.isArray(f)?t.select("#info").call(k,`${l.properties[f[0]]}\n${l.properties[f[1]]}\n${f[2]}`):t.select("#info").call(k,`${l.properties[f]}`)),""!=f&&(t.select("#info").attr("transform",`translate(${B.pointer(e,this)})`),B.select(this).attr("stroke-width",p+.5).attr("fill-opacity",g-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),B.select(this).attr("stroke-width",p).attr("fill-opacity",g)}));const S=u.filter((t=>""!=t.properties[o])).map((t=>+t.properties[o])),j=[B.min(S),O.invert(i/3),O.invert(i/1.5),B.max(S)];if(null!=d&&null!=h){let e=t.append("g");null!=y&&(y.split("\n").length,e.append("g").selectAll("text").data(y.split("\n")).join("text").attr("x",d).attr("y",h).attr("font-size",`${m}px`).attr("dy",((t,e)=>e*m)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",b).text((t=>t))),e.append("g").selectAll("path").data(j.sort(B.descending)).join("path").attr("d",(t=>`M ${-n/2},0 0,${-O(t)} ${n/2},0`)).attr("fill",s).attr("stroke",c).attr("stroke-width",p).attr("fill-opacity",g).attr("transform",((t,e)=>`translate(${d+n/2+(n+5)*e},${h+i+(y.split("\n").length+1)*m})`)),e.append("g").selectAll("text").data(j.sort(B.descending)).join("text").attr("text-anchor","start").attr("alignment-baseline","middle").attr("transform",((t,e)=>`translate(${d+n/2+(n+5)*e},${h+i+(y.split("\n").length+1)*m+x/2}) rotate(90)`)).attr("font-size",`${x}px`).attr("fill",b).text((t=>function(t,e){let l;return e>=0&&(l=+t.toFixed(e)),e<0&&(l=Math.round(t/+(1+"0".repeat(Math.abs(e))))*+(1+"0".repeat(Math.abs(e)))),null==e&&(l=t),l}(t,w)))}}const J=Object.assign({},t,i,o,e,l,a);const N=Object.assign({},e);const T=Object.assign({},t,e,l);function R({params:t={},layers:e={}}={}){let l=t.projection?t.projection:T.geoEquirectangular();"string"==typeof l&&(l=function(t){const e=180/Math.PI,l=1/e,r=f(t),a=function(t,l){return r.forward([t*e,l*e])};a.invert=function(t,e){return r.inverse([t,e]).map((function(t){return t*l}))};const o=N.geoProjection(a).scale(1);return o.raw=r,o}(l));let r=t.width?t.width:1e3,a=t.extent?t.extent:null,o=t.margin?t.margin:1,i=t.background,n=function(t,e,l,r,a){let o;if(e)o=e;else if(null!=t.find((t=>"outline"==t.type)))t.find((t=>"outline"==t.type)),o={type:"Sphere"};else{let e=t.map((t=>t.geojson)).filter((t=>void 0!==t)),l=[];e.forEach((t=>l.push(t.features))),o={type:"FeatureCollection",features:l.flat()}}const[[i,n],[s,c]]=P.geoPath(r.fitWidth(a-2*l,o)).bounds(o);let p=r.translate();return r.translate([p[0]+l,p[1]+l]),Math.ceil(c-n)+2*l}(e,a,o,l,r),s=0,c=e.find((t=>"header"==t.type));c&&(c.text&&(s=25*c.text.split("\n").length+10),c.fontSize&&(s=c.fontSize*c.text.split("\n").length+10));let p=0,g=e.find((t=>"footer"==t.type));g&&(g.text&&(p=10*g.text.split("\n").length+10),g.fontSize&&(p=g.fontSize*g.text.split("\n").length+10));const h=T.create("svg").attr("width",r).attr("height",n+s+p).attr("viewBox",[0,-s,r,n+s+p]).attr("style","max-width: 100%; height: auto; height: intrinsic; background-color: white;");let u=h.append("defs");u.append("style").attr("type","text/css").text("@import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto&family=Rubik&family=Ubuntu&display=swap');");const w=Date.now().toString(36)+Math.random().toString(36).substr(2);h.append("clipPath").attr("id",`clip_${w}`).append("path").datum({type:"Sphere"}).attr("d",T.geoPath(l)),i&&h.append("rect").attr("x",0).attr("y",0).attr("width",r).attr("height",n).attr("fill",i);let S=e.find((t=>"outline"==t.type));S&&y(h,l,{fill:S.fill,fillOpacity:S.fillOpacity,stroke:"none",strokeWidth:"none"}),e.reverse().forEach((t=>{"graticule"==t.type&&function(t,e,l,r={}){let a=r.stroke?r.stroke:"white",o=r.strokeWidth?r.strokeWidth:.8,i=r.strokeOpacity?r.strokeOpacity:.5,n=r.strokeDasharray?r.strokeDasharray:2,s=r.step?r.step:[10,10];s=Array.isArray(s)?s:[s,s],t.append("g").attr(":inkscape:groupmode","layer").attr("id","graticule").attr(":inkscape:label","graticule").append("path").datum(d.geoGraticule().step(s)).attr("d",d.geoPath(e)).style("fill","none").style("stroke",a).style("stroke-width",o).style("stroke-opacity",i).style("stroke-dasharray",n).attr("clip-path",`url(#clip_${l}`)}(h,l,w,{stroke:t.stroke,strokeWidth:t.strokeWidth,strokeOpacity:t.strokeOpacity,strokeDasharray:t.strokeDasharray,step:t.step}),"layer"==t.type&&function(t,e,l,r,a={}){let o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],i=a.fill?a.fill:o[Math.floor(Math.random()*o.length)],n=a.stroke?a.stroke:"white",s=a.strokeWidth?a.strokeWidth:.5,c=a.fillOpacity?a.fillOpacity:1,p=a.tooltip?a.tooltip:"",g=a.symbol?a.symbol:"circle",f=a.symbol_size?a.symbol_size:40,d=a.symbol_interation?a.symbol_interation:200,h=a.symbol_shift?a.symbol_shift:0;if("l"==_(r)&&(n=a.stroke?a.stroke:o[Math.floor(Math.random()*o.length)],i=a.fill?a.fill:"none",s=a.strokeWidth?a.strokeWidth:1),"l"!=_(r)&&"z"!=_(r)||t.append("g").attr(":inkscape:groupmode","layer").attr("id","simple layer").attr(":inkscape:label","simple layer").selectAll("path").data(r.features).join("path").attr("d",x.geoPath(e)).attr("fill",i).attr("stroke",n).attr("stroke-width",s).attr("fill-opacity",c).attr("clip-path",`url(#clip_${l}`).on("touchmove mousemove",(function(e,l){""!=p&&(Array.isArray(p)?t.select("#info").call(k,`${l.properties[p[0]]}\n${l.properties[p[1]]}\n${p[2]}`):t.select("#info").call(k,`${l.properties[p]}`)),""!=p&&(t.select("#info").attr("transform",`translate(${x.pointer(e,this)})`),x.select(this).attr("stroke-width",s+.5).attr("fill-opacity",c-.3).raise())})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),x.select(this).attr("stroke-width",s).attr("fill-opacity",c).lower()})),"p"==_(r)){const l=x.forceSimulation(r.features).force("x",x.forceX((t=>e(t.geometry.coordinates)[0]))).force("y",x.forceY((t=>e(t.geometry.coordinates)[1]))).force("collide",x.forceCollide(Math.sqrt(f)/2+h/2));for(let t=0;t<d;t++)l.tick();const a=["circle","cross","diamond","square","star","triangle","wye"];t.append("g").attr(":inkscape:groupmode","layer").attr("id","simple layer").attr(":inkscape:label","simple layer").selectAll("path").data(r.features).join("path").attr("d",x.symbol().size(f).type(x.symbols[a.indexOf(g)])).attr("transform",(t=>`translate(\n       ${h?t.x:e(t.geometry.coordinates)[0]},\n       ${h?t.y:e(t.geometry.coordinates)[1]})`)).attr("fill",i).attr("stroke",n).attr("stroke-width",s).attr("fill-opacity",c).on("touchmove mousemove",(function(l,r){""!=p&&(Array.isArray(p)?t.select("#info").call(k,`${r.properties[p[0]]}\n${r.properties[p[1]]}\n${p[2]}`):t.select("#info").call(k,`${r.properties[p]}`)),""!=p&&(t.select("#info").attr("transform",`translate(\n      ${h?r.x:e(r.geometry.coordinates)[0]},\n      ${h?r.y:e(r.geometry.coordinates)[1]})`),x.select(this).attr("stroke-width",s+.5).attr("fill-opacity",c-.3).raise())})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),x.select(this).attr("stroke-width",s).attr("fill-opacity",c).lower()}))}m(t,{x:a.leg_x,y:a.leg_y,w:a.leg_w,h:a.leg_h,title:a.leg_title,text:a.leg_text,fontsize:a.leg_fontsize,fontsize2:a.leg_fontsize2,stroke:a.leg_stroke,fillOpacity:a.leg_fillOpacity?a.leg_fillOpacity:c,fill:a.leg_fill?a.leg_fill:i,strokeWidth:a.leg_strokeWidth,txtcol:a.leg_txtcol})}(h,l,w,t.geojson,{fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,symbol:t.symbol,symbol_size:t.symbol_size,symbol_interation:t.symbol_interation,symbol_shift:t.symbol_shift,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_w:t.leg_w,leg_h:t.leg_h,leg_title:t.leg_title,leg_text:t.leg_text,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_stroke:t.leg_stroke,leg_fillOpacity:t.leg_fillOpacity,leg_fill:t.leg_fill,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol}),"spikes"==t.type&&q(h,l,w,{geojson:t.geojson,values:t.values,k:t.k,w:t.w,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_w:t.leg_w,leg_h:t.leg_h,leg_title:t.leg_title,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_stroke:t.leg_stroke,leg_fillOpacity:t.leg_fillOpacity,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol,leg_round:t.leg_round}),"typo"==t.type&&$(h,l,w,{geojson:t.geojson,values:t.values,colors:t.colors,pal:t.pal,col_missing:t.col_missing,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_title:t.leg_title,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_stroke:t.leg_stroke,leg_fillOpacity:t.leg_fillOpacity,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol}),"choro"==t.type&&A(h,l,w,{geojson:t.geojson,values:t.values,pal:t.pal,nbreaks:t.nbreaks,breaks:t.breaks,colors:t.colors,method:t.method,col_missing:t.col_missing,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_w:t.leg_w,leg_h:t.leg_h,leg_title:t.leg_title,leg_text:t.leg_text,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_stroke:t.leg_stroke,leg_fillOpacity:t.leg_fillOpacity,leg_fill:t.leg_fill,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol,leg_round:t.leg_round}),"mushroom"==t.type&&function(t,e,l,r={}){let a=r.geojson,o=r.top_values,i=r.bottom_values,n=r.top_fill?r.top_fill:"#d64f4f",s=r.bottom_fill?r.bottom_fill:"#4fabd6",c=r.k?r.k:50,p=r.stroke?r.stroke:"white",g=r.strokeWidth?r.strokeWidth:.5,f=r.fillOpacity?r.fillOpacity:1,d=r.top_tooltip?r.top_tooltip:"",h=r.bottom_tooltip?r.bottom_tooltip:"",y=r.leg_x?r.leg_x:null,_=r.leg_y?r.leg_y:null,m=r.leg_fontSize?r.leg_fontSize:14,x=r.leg_fontSize2?r.leg_fontSize2:10,u=r.leg_round?r.leg_round:void 0,b=r.leg_txtcol?r.leg_txtcol:"#363636",w=r.leg_title?r.leg_title:"Title, year",O=r.leg_top_txt?r.leg_top_txt:o,S=r.leg_bottom_txt?r.leg_bottom_txt:i,j=r.leg_top_fill?r.leg_top_fill:n,$=r.leg_bottom_fill?r.leg_bottom_fill:s,v=r.leg_stroke?r.leg_stroke:b,W=r.leg_strokeWidth?r.leg_strokeWidth:.8;const A=z(a).sort(((t,e)=>M.descending(+t.properties[o],+e.properties[o]))).filter((t=>null!=t.geometry.coordinates)),C=M.max(A,(t=>+t.properties[o])),P=M.max(A,(t=>+t.properties[i]));let D=M.scaleSqrt([0,Math.max(C,P)],[0,c]);for(let r=0;r<A.length;r++){const a=e(A[r].geometry.coordinates)[0],c=e(A[r].geometry.coordinates)[1],y=D(A[r].properties[o]),_=D(A[r].properties[i]),m=Math.max(y,_);t.append("circle").attr("cx",a).attr("cy",c).attr("r",y).style("fill",n).attr("stroke",p).attr("stroke-width",g).attr("clip-path","url(#top-clip_"+l+r+")").on("touchmove mousemove",(function(e,l){""!=d&&(Array.isArray(d)?t.select("#info").call(k,`${A[r].properties[d[0]]}\n${A[r].properties[d[1]]}\n${d[2]}`):t.select("#info").call(k,`${l.properties[d]}`)),""!=d&&(t.select("#info").attr("transform",`translate(${M.pointer(e,this)})`),M.select(this).attr("stroke-width",g+.5).attr("fill-opacity",f-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),M.select(this).attr("stroke-width",g).attr("fill-opacity",f)})),t.append("clipPath").attr("id","top-clip_"+l+r).append("rect").attr("x",a-y-g).attr("y",c+-y-g).attr("height",y+g).attr("width",2*y+2*g),t.append("circle").attr("cx",a).attr("cy",c).attr("r",_).style("fill",s).attr("stroke",p).attr("stroke-width",g).attr("clip-path","url(#bottom-clip_"+l+r+")").on("touchmove mousemove",(function(e){""!=h&&(Array.isArray(h)?t.select("#info").call(k,`${A[r].properties[h[0]]}\n${A[r].properties[h[1]]}\n${h[2]}`):t.select("#info").call(k,`${A[r].properties[h]}`)),""!=h&&(t.select("#info").attr("transform",`translate(${M.pointer(e,this)})`),M.select(this).attr("stroke-width",g+.5).attr("fill-opacity",f-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),M.select(this).attr("stroke-width",g).attr("fill-opacity",f)})),t.append("clipPath").attr("id","bottom-clip_"+l+r).append("rect").attr("x",a-_-g).attr("y",c).attr("height",_+g).attr("width",2*_+2*g).attr("fill","none").attr("stroke","red"),t.append("line").attr("x1",a-m).attr("x2",a+m).attr("y1",c).attr("y2",c).attr("stroke",p).attr("stroke-width",g)}if(null!=y&&null!=_){const e=30,r=3,n=D(Math.max(+C,+P));let s=t.append("g");const c=D(M.max(A,(t=>+t.properties[o])));let p=A.map((t=>+t.properties[o])),g=[D.invert(c/3),D.invert(c/1.5),M.max(p)];s.selectAll("circle").data(g.sort(M.descending)).join("circle").attr("cx",y+n).attr("cy",_+c+(w.split("\n").length+1)*m).attr("r",(t=>D(t))).attr("fill",j).attr("stroke",v).attr("stroke-width",W).attr("clip-path","url(#legtop-clip_"+l+")"),s.append("clipPath").attr("id","legtop-clip_"+l).append("rect").attr("x",y-W+n-c).attr("y",_+(w.split("\n").length+1)*m-W).attr("height",c+W).attr("width",2*c+2*W),s.selectAll("line").data(g).join("line").attr("x1",y+n).attr("y1",(t=>_+(w.split("\n").length+1)*m+c-D(t))).attr("x2",y+2*n+m).attr("y2",(t=>_+(w.split("\n").length+1)*m+c-D(t))).attr("stroke",v).attr("stroke-width",W).attr("stroke-dasharray",2),s.selectAll("text").data(g).join("text").attr("x",y+2*n+m+x/2).attr("y",(t=>_+(w.split("\n").length+1)*m+c-D(t))).attr("font-size",x).attr("alignment-baseline","central").attr("fill",b).text((t=>void 0!==u||0!==u?t.toFixed(u):t));let f=t.append("g");const d=D(M.max(A,(t=>+t.properties[i])));let h=a.features.map((t=>+t.properties[i])),k=[D.invert(d/3),D.invert(d/1.5),M.max(h)];f.selectAll("circle").data(k.sort(M.descending)).join("circle").attr("cx",y+n).attr("cy",_+c+(w.split("\n").length+1)*m+e).attr("r",(t=>D(t))).attr("fill",$).attr("stroke",v).attr("stroke-width",W).attr("clip-path","url(#legbottom-clip_"+l+")"),f.append("clipPath").attr("id","legbottom-clip_"+l).append("rect").attr("x",y-W+n-d).attr("y",_+(w.split("\n").length+1)*m+e+c).attr("height",d+W).attr("width",2*d+2*W),f.selectAll("line").data(k).join("line").attr("x1",y+n).attr("y1",(t=>_+(w.split("\n").length+1)*m+c+e+D(t))).attr("x2",y+2*n+m).attr("y2",(t=>_+(w.split("\n").length+1)*m+c+e+D(t))).attr("stroke",v).attr("stroke-width",W).attr("stroke-dasharray",2),f.selectAll("text").data(k).join("text").attr("x",y+2*n+m+x/2).attr("y",(t=>_+(w.split("\n").length+1)*m+c+e+D(t))).attr("font-size",x).attr("alignment-baseline","central").attr("fill",b).text((t=>void 0!==u||0!==u?t.toFixed(u):t));let z=t.append("g");z.append("line").attr("x1",y+n-c).attr("x2",y+n+c).attr("y1",_+(w.split("\n").length+1)*m+c).attr("y2",_+(w.split("\n").length+1)*m+c).attr("stroke",b).attr("stroke-width",W),z.append("line").attr("x1",y+n-d).attr("x2",y+n+d).attr("y1",_+(w.split("\n").length+1)*m+c+e).attr("y2",_+(w.split("\n").length+1)*m+c+e).attr("stroke",b).attr("stroke-width",W),z.append("g").selectAll("text").data(w.split("\n")).join("text").attr("x",y).attr("y",_).attr("font-size",`${m}px`).attr("dy",((t,e)=>e*m)).attr("text-anchor","start").attr("alignment-baseline","hanging").attr("fill",b).text((t=>t)),z.append("text").attr("x",y+n).attr("y",_+(w.split("\n").length+1)*m+c+r).text(O).attr("fill",b).attr("font-size",`${x}px`).attr("text-anchor","middle").attr("alignment-baseline","hanging"),z.append("text").attr("x",y+n).attr("y",_+(w.split("\n").length+1)*m+c+e-r).text(S).attr("fill",b).attr("font-size",`${x}px`).attr("text-anchor","middle").attr("alignment-baseline","baseline")}}(h,l,w,{geojson:t.geojson,top_values:t.top_values,bottom_values:t.bottom_values,top_fill:t.top_fill,bottom_fill:t.bottom_fill,k:t.k,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,top_tooltip:t.top_tooltip,bottom_tooltip:t.bottom_tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_round:t.leg_round,leg_txtcol:t.leg_txtcol,leg_title:t.leg_title,leg_top_txt:t.leg_top_txt,leg_bottom_txt:t.leg_bottom_txt,leg_top_fill:t.leg_top_fill,leg_bottom_fill:t.leg_bottom_fill,leg_stroke:t.leg_stroke,leg_strokeWidth:t.leg_strokeWidth}),"label"==t.type&&function(t,e,l,r={}){let a=r.geojson,o=r.values,i=r.fill?r.fill:"#474342",n=r.fontSize?r.fontSize:10,s=r.fontFamily?r.fontFamily:"Robotto",c=r.textDecoration?r.textDecoration:"none",p=r.fontWeight?r.fontWeight:"normal",g=r.fontStyle?r.fontStyle:"normal",f=r.opacity?r.opacity:1;const d=z(a);t.append("g").selectAll("text").data(d.filter((t=>null!=t.geometry.coordinates)).filter((t=>null!=t.properties[o]))).join("text").attr("x",(t=>e(t.geometry.coordinates)[0])).attr("y",(t=>e(t.geometry.coordinates)[1])).attr("fill",i).attr("opacity",f).attr("font-size",n).attr("font-family",s).attr("font-style",g).attr("text-decoration",c).attr("font-weight",p).attr("text-anchor","middle").attr("alignment-baseline","middle").text((t=>t.properties[o]))}(h,l,0,{geojson:t.geojson,values:t.values,fill:t.fill,fontSize:t.fontSize,fontFamily:t.fontFamily,textDecoration:t.textDecoration,fontWeight:t.fontWeight,fontStyle:t.fontStyle,opacity:t.opacity}),"text"==t.type&&function(t,e,l,r={}){let a,o,i,n,s,c,p=r.position?r.position:"topright",g=r.text?r.text:"Your text here!",f=r.fontSize?r.fontSize:15,d=r.fontFamily?r.fontFamily:"Robotto",h=r.margin?r.margin:0,y=r.textDecoration?r.textDecoration:"none",_=r.fontWeight?r.fontWeight:"normal",k=r.fontStyle?r.fontStyle:"normal",m=r.anchor?r.anchor:"start",x=r.baseline?r.baseline:"baseline",u=r.fill?r.fill:"#474342",b=r.stroke?r.stroke:"none",w=r.frame_fill?r.frame_fill:"none",z=r.frame_stroke?r.frame_stroke:"none",O=r.strokeWidth?r.strokeWidth:1,S=r.frame_opacity?r.frame_opacity:1;switch(p){case"topleft":m="start",x="hanging",a=5,o=5;break;case"topright":m="end",x="hanging",a=e-5,o=5;break;case"top":m="middle",x="hanging",a=e/2,o=5;break;case"left":m="start",x="middle",a=5,o=l/2;break;case"middle":m="middle",x="middle",a=e/2,o=l/2;break;case"right":m="end",x="middle",a=e-5,o=l/2;break;case"bottomleft":m="start",x="baseline",a=5,o=l-5;break;case"bottom":m="middle",x="baseline",a=e/2,o=l-5;break;case"bottomright":m="end",x="baseline",a=e-5,o=l-5;break;default:a=p[0],o=p[1]}let j=g.split("\n"),$=[];j.forEach((t=>$.push(t.length)));let v=$.indexOf(Math.max(...$)),W=t.append("text").attr("font-size",`${f}px`).attr("font-family",d).attr("font-style",k).attr("text-decoration",y).attr("font-weight",_).text(j[v]);t.node().appendChild(W.node()),document.body.appendChild(t.node());const A=W.node().getBBox().width;document.body.removeChild(t.node()),W.remove();let M=f*$.length;"hanging"==x&&(s=0,n=h),"middle"==x&&(s=f*j.length/2,n=0),"baseline"==x&&(s=f*j.length,n=-h),"start"==m&&(c=0,i=h),"middle"==m&&(c=A/2,i=0),"end"==m&&(c=A,i=-h);let C=t.append("g").attr(":inkscape:groupmode","layer").attr("id","note").attr(":inkscape:label","note");C.append("rect").attr("x",a-h-c+i).attr("y",o-h-s+n).attr("height",M+2*h).attr("width",A+2*h).attr("fill",w).attr("stroke-width",O).attr("fill-opacity",S).attr("stroke",z),C.selectAll("text").data(j).join("text").attr("x",a+i).attr("y",o-+s+n+3*fontsize/4).attr("font-size",`${f}px`).attr("font-style",k).attr("text-decoration",y).attr("font-weight",_).attr("font-family",d).attr("dy",((t,e)=>e*f)).attr("text-anchor",m).attr("fill",u).attr("stroke",b).text((t=>t))}(h,r,n,{position:t.position,text:t.text,fill:t.fill,stroke:t.stroke,fontSize:t.fontSize,fontFamily:t.fontFamily,textDecoration:t.textDecoration,fontWeight:t.fontWeight,fontStyle:t.fontStyle,margin:t.margin,anchor:t.anchor,baseline:t.baseline,frame_fill:t.frame_fill,frame_stroke:t.frame_stroke,frame_opacity:t.frame_opacity,frame_strokeWidth:t.frame_strokeWidth}),"missing"==t.type&&function(t,e,l,r={}){let a=r.geojson,o=r.values,i=r.fill?r.fill:"white",n=r.stroke?r.stroke:"white",s=r.strokeWidth?r.strokeWidth:.5,c=r.fillOpacity?r.fillOpacity:1,p=a.features.filter((t=>null==t.properties[o]));"l"==_(a)&&(n=r.stroke?r.stroke:"white",i=r.fill?r.fill:"none",s=r.strokeWidth?r.strokeWidth:1),t.append("g").attr(":inkscape:groupmode","layer").attr("id","missing").attr(":inkscape:label","missing").selectAll("path").data(p).join("path").attr("d",C.geoPath(e)).attr("fill",i).attr("stroke",n).attr("stroke-width",s).attr("fill-opacity",c).attr("clip-path",`url(#clip_${l}`),m(t,{x:r.leg_x,y:r.leg_y,w:r.leg_w,h:r.leg_h,text:r.leg_text?r.leg_text:"Missing data",fontSize:r.leg_fontSize2,stroke:r.leg_stroke,fillOpacity:r.leg_fillOpacity?r.leg_fillOpacity:c,fill:i,strokeWidth:r.leg_strokeWidth,txtcol:r.leg_txtcol})}(h,l,w,{geojson:t.geojson,values:t.values,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,leg_x:t.leg_x,leg_y:t.leg_y,leg_w:t.leg_w,leg_h:t.leg_h,leg_text:t.leg_text,leg_fontSize:t.leg_fontSize,leg_stroke:t.leg_stroke,leg_fillOpacity:t.fillOpacity,leg_fill:t.fill,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol}),"shadow"==t.type&&function(t,e,l,r,a,o={}){let i=o.col?o.col:"#35383d",n=o.dx?o.dx:3,s=o.dy?o.dy:3,c=o.stdDeviation?o.stdDeviation:1.5,p=o.opacity?o.opacity:.7,g=i,f=F.topology({foo:l}),d=F.merge(f,f.objects.foo.geometries);a.append("filter").attr("id","blur").append("feGaussianBlur").attr("stdDeviation",c);const h=D.geoPath(e);t.append("g").attr(":inkscape:groupmode","shadow").attr("id","simple layer").attr(":inkscape:label","shadow").append("path").datum(d).attr("d",h).attr("fill",g).attr("opacity",p).attr("stroke","none").attr("clip-path",`url(#clip_${r}`).attr("filter","url(#blur)").attr("transform",`translate(${n} ${s})`)}(h,l,t.geojson,w,u,{col:t.col,dx:t.dx,dy:t.dy,opacity:t.opacity,stdDeviation:t.stdDeviation}),"prop"==t.type&&function(t,e,l,r={}){let a,o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],i=r.geojson,n=r.values,s=r.k?r.k:50,c=r.fill?r.fill:o[Math.floor(Math.random()*o.length)],p=r.stroke?r.stroke:"white",g=r.strokeWidth?r.strokeWidth:.5,f=r.fillOpacity?r.fillOpacity:1,d=r.tooltip?r.tooltip:"";a="p"==_(i)?i.features:z(i);let h=O.scaleSqrt([0,O.max(a,(t=>+t.properties[n]))],[0,s]);t.append("g").selectAll("circle").data(a.filter((t=>null!=t.geometry.coordinates)).filter((t=>null!=t.properties[n])).sort(((t,e)=>O.descending(+t.properties[n],+e.properties[n])))).join("circle").attr("fill",c).attr("stroke",p).attr("stroke-width",g).attr("fill-opacity",f).attr("cx",(t=>e(t.geometry.coordinates)[0])).attr("cy",(t=>e(t.geometry.coordinates)[1])).attr("r",(t=>h(t.properties[n]))).attr("clip-path",`url(#clip_${l}_rectangle)`).on("touchmove mousemove",(function(e,l){""!=d&&(Array.isArray(d)?t.select("#info").call(k,`${l.properties[d[0]]}\n${l.properties[d[1]]}\n${d[2]}`):t.select("#info").call(k,`${l.properties[d]}`)),""!=d&&(t.select("#info").attr("transform",`translate(${O.pointer(e,this)})`),O.select(this).attr("stroke-width",g+.5).attr("fill-opacity",f-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),O.select(this).attr("stroke-width",g).attr("fill-opacity",f)}));let y=a.map((t=>+t.properties[n])),m=[O.min(y),h.invert(s/3),h.invert(s/1.5),O.max(y)];b(t,{x:r.leg_x,y:r.leg_y,round:r.leg_round,k:s,stroke:r.leg_stroke,fill:r.leg_fill,strokeWidth:r.leg_strokeWidth,txtcol:r.leg_txtcol,title:r.leg_title,fontSize:r.leg_fontSize,fontSize2:r.leg_fontSize2,title:r.leg_title?r.leg_title:n,values:m})}(h,l,w,{geojson:t.geojson,values:t.values,k:t.k,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_stroke:t.leg_stroke,leg_fill:t.leg_fill,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol,leg_title:t.leg_title,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_round:t.leg_round}),"dorling"==t.type&&function(t,e,l,r={}){let a,o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],i=r.geojson,n=r.values,s=r.k?r.k:50,c=r.fill?r.fill:o[Math.floor(Math.random()*o.length)],p=r.stroke?r.stroke:"white",g=r.strokewidth?r.strokewidth:.5,f=r.fillopacity?r.fillopacity:1,d=r.tooltip?r.tooltip:"",h=r.interation?r.interation:200;a="p"==_(i)?i.features:z(i);let y=J.scaleSqrt([0,J.max(a,(t=>+t.properties[n]))],[0,s]);const m=J.forceSimulation(a).force("x",J.forceX((t=>e(t.geometry.coordinates)[0]))).force("y",J.forceY((t=>e(t.geometry.coordinates)[1]))).force("collide",J.forceCollide((t=>y(t.properties[n]))));for(let t=0;t<h;t++)m.tick();t.append("g").selectAll("circle").data(a.filter((t=>null!=t.geometry.coordinates)).filter((t=>null!=t.properties[n])).sort(((t,e)=>J.descending(+t.properties[n],+e.properties[n])))).join("circle").attr("fill",c).attr("stroke",p).attr("stroke-width",g).attr("fill-opacity",f).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",(t=>y(t.properties[n]))).on("touchmove mousemove",(function(e,l){""!=d&&(Array.isArray(d)?t.select("#info").call(k,`${l.properties[d[0]]}\n${l.properties[d[1]]}\n${d[2]}`):t.select("#info").call(k,`${l.properties[d]}`)),""!=d&&(t.select("#info").attr("transform",`translate(${J.pointer(e,this)})`),J.select(this).attr("stroke-width",g+.5).attr("fill-opacity",f-.3))})).on("touchend mouseleave",(function(){t.select("#info").call(k,null),J.select(this).attr("stroke-width",g).attr("fill-opacity",f)}));let x=a.map((t=>+t.properties[n])),u=[J.min(x),y.invert(s/3),y.invert(s/1.5),J.max(x)];b(t,{x:r.leg_x,y:r.leg_y,round:r.leg_round,k:s,stroke:r.leg_stroke,fill:r.leg_fill,strokewidth:r.leg_strokewidth,txtcol:r.leg_txtcol,title:r.leg_title,fontsize:r.leg_fontsize,fontsize2:r.leg_fontsize2,title:r.leg_title?r.leg_title:n,values:u})}(h,l,0,{geojson:t.geojson,values:t.values,k:t.k,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,fillOpacity:t.fillOpacity,tooltip:t.tooltip,leg_x:t.leg_x,leg_y:t.leg_y,leg_stroke:t.leg_stroke,leg_fill:t.leg_fill,leg_strokeWidth:t.leg_strokeWidth,leg_txtcol:t.leg_txtcol,leg_title:t.leg_title,leg_fontSize:t.leg_fontSize,leg_fontSize2:t.leg_fontSize2,leg_round:t.leg_round}),"header"==t.type&&function(t,e,l={}){let r;l.text&&(r=25),l.fontSize&&(r=l.fontSize);let a=l.text?l.text:"",o=l.fill?l.fill:"#9e9696",i=l.background?l.background:"white",n=l.backgroundOpacity?l.backgroundOpacity:1,s=l.anchor?l.anchor:"middle";const c=r*a.split("\n").length;let p;"start"==s&&(p=5),"middle"==s&&(p=e/2),"end"==s&&(p=e-5);let g=t.append("g").attr(":inkscape:groupmode","layer").attr("id","header").attr(":inkscape:label","header");g.append("rect").attr("x",0).attr("y",0-c-10).attr("width",e).attr("height",c+10).attr("fill",i).attr("fill-opacity",n),g.selectAll("text").data(l.text.split("\n")).join("text").attr("x",p).attr("y",-c+fontsize/2).attr("font-size",`${r}px`).attr("dy",((t,e)=>e*r)).attr("text-anchor",s).attr("fill",o).attr("font-family","sans-serif").attr("font-weight","bold").attr("fill-opacity",1).text((t=>t))}(h,r,{fontSize:t.fontSize,text:t.text,fill:t.fill,background:t.background,backgroundOpacity:t.backgroundOpacity,anchor:t.anchor}),"footer"==t.type&&function(t,e,l,r={}){let a;r.text&&(a=10),r.fontSize&&(a=r.fontSize);let o=r.text?r.text:"",i=r.fill?r.fill:"#9e9696",n=r.background?r.background:"white",s=r.backgroundOpacity?r.backgroundOpacity:1,c=r.anchor?r.anchor:"end";const p=a*o.split("\n").length;let g;"start"==c&&(g=5),"middle"==c&&(g=e/2),"end"==c&&(g=e-5);let f=t.append("g").attr(":inkscape:groupmode","layer").attr("id","footer").attr(":inkscape:label","footer");f.append("rect").attr("x",0).attr("y",l).attr("width",e).attr("height",p+10).attr("fill",n).attr("fill-opacity",s),f.selectAll("text").data(r.text.split("\n")).join("text").attr("x",g).attr("y",l+a/2+8).attr("font-size",`${a}px`).attr("dy",((t,e)=>e*a)).attr("text-anchor",c).attr("fill",i).attr("font-family","sans-serif").attr("fill-opacity",1).text((t=>t))}(h,r,n,{fontSize:t.fontSize,text:t.text,fill:t.fill,background:t.background,backgroundOpacity:t.backgroundOpacity,anchor:t.anchor})}));let j=e.find((t=>"scalebar"==t.type));return j&&function(t,e,l,r,a={}){let o=a.x?a.x:20,i=a.y?a.y:r-30,n=a.units?a.units:"kilometers";o/=l,i/=r;const s=E.geoScaleBar().projection(e).size([l,r]).left(o).top(i).units("miles"==n?E.geoScaleMiles:E.geoScaleKilometers).orient(E.geoScaleBottom).tickPadding(5).tickSize(0);t.append("g").attr("transform",`translate(${o}, ${i})`).append("g").call(s)}(h,l,r,n,{x:j.x,y:j.y,units:j.units}),S&&y(h,l,{fill:"none",stroke:S.stroke,strokeWidth:S.strokeWidth}),h.append("g").attr("id","info").attr("class","info"),Object.assign(h.node(),{})}const L=Object.assign({},t,o);function G(t,e,l,r){let a=t.features.map((t=>t.properties[e])),o=l.map((t=>t[r])),i=Array.from(new Set(a.concat(o))),n=a.filter((t=>o.includes(t))),s=a.filter((t=>!o.includes(t))),c=o.filter((t=>!a.includes(t))),p=n.filter((t=>o.includes(t))),g=n.filter((t=>a.includes(t))),f=1e3,d=100,h=30,y=L.scaleLinear().domain([0,i.length]).range([0,f]);const _=L.create("svg").attr("width",f).attr("height",d).attr("viewBox",[0,0,f,d]).attr("style","max-width: 100%; height: auto; height: intrinsic; background-color: white;");return _.append("defs").append("pattern").attr("id","hatch").attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5).append("line").attr("x1",0).attr("y1",0).attr("x2",5).attr("y1",5).attr("stroke","#ffcc36").attr("stroke-width",1).attr("stroke-opacity",1),_.append("rect").attr("x",0).attr("y",25).attr("height",10).attr("width",y(s.length+n.length)).attr("stroke","none").attr("fill","#CCC").attr("fill-opacity",.35),_.append("rect").attr("x",f-y(c.length+n.length)).attr("y",65).attr("height",10).attr("width",y(c.length+n.length)).attr("stroke","none").attr("fill","#CCC").attr("fill-opacity",.35),_.append("rect").attr("x",y(s.length)).attr("y",h).attr("height",40).attr("width",y(n.length)).attr("fill","#ffe599"),_.append("rect").attr("x",y(s.length)).attr("y",h).attr("height",40).attr("width",y(n.length)).attr("fill","url('#hatch')"),_.append("text").attr("x",f-y(o.length)+y(n.length)/2).attr("y",53).attr("text-anchor","middle").attr("alignment-baseline","middle").text(`${Math.round(n.length/i.length*100)}%`).attr("font-size",40).attr("fill","black"),_.append("text").attr("x",f-y(o.length)+5).attr("y",37).attr("text-anchor","start").attr("alignment-baseline","hanging").text("Matched geom").attr("font-size",12).attr("fill","black"),_.append("text").attr("x",f-y(o.length)+5).attr("y",62).attr("text-anchor","start").attr("alignment-baseline","baseline").text(`${n.length}/${a.length}`).attr("font-size",14).attr("fill","black"),_.append("text").attr("x",f-y(c.length)-5).attr("y",37).attr("text-anchor","end").attr("alignment-baseline","hanging").text("Matched data").attr("font-size",12).attr("fill","black"),_.append("text").attr("x",f-y(c.length)-5).attr("y",62).attr("text-anchor","end").attr("alignment-baseline","baseline").text(`${n.length}/${o.length}`).attr("font-size",14).attr("fill","black"),_.append("line").attr("x1",0).attr("y1",h).attr("x2",y(a.length)).attr("y2",h).attr("stroke","black").attr("stroke-width",.5),_.append("line").attr("x1",.5).attr("y1",25).attr("x2",.5).attr("y2",35).attr("stroke","black").attr("stroke-width",.5),_.append("line").attr("x1",y(a.length)-.5).attr("y1",25).attr("x2",y(a.length)-.5).attr("y2",35).attr("stroke","black").attr("stroke-width",.5),_.append("line").attr("x1",f-y(o.length)).attr("y1",70).attr("x2",f).attr("y2",70).attr("stroke","black").attr("stroke-width",.5),_.append("line").attr("x1",999.5).attr("y1",65).attr("x2",999.5).attr("y2",75).attr("stroke","black").attr("stroke-width",.5),_.append("line").attr("x1",f-y(o.length)+.5).attr("y1",65).attr("x2",f-y(o.length)+.5).attr("y2",75).attr("stroke","black").attr("stroke-width",.5),_.append("text").attr("x",f-y(o.length/2)).attr("y",95).attr("text-anchor","middle").text("DATA").attr("font-size",28).attr("font-weight","bold").attr("fill","#CCC").attr("opacity",.45),_.append("text").attr("x",y(a.length/2)).attr("y",22).attr("text-anchor","middle").text("GEOMETRIES").attr("font-size",28).attr("font-weight","bold").attr("fill","#CCC").attr("opacity",.45),Object.assign(_.node(),{matched:n,unmatched_geom:s,unmatched_data:c,matched_data:p,matched_geom:g})}const U=Object.assign({},i);function Y(t,e,l,r,a=!0){let o=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(l)),n=o.features.map((t=>t.properties[e])),s=l.map((t=>t[r]));n.filter((t=>s.includes(t)));let c=Object.keys(o.features[0].properties);if(console.log(c),Object.keys(i[0]).includes(r)){let t=U.index(i,(t=>t[r]));o.features.forEach((l=>{const r=t.get(l.properties[e]);null!=r&&Object.keys(r).forEach((t=>{void 0!==c.find((e=>e==t))&&(r[`_${t}`]=r[t],delete r[t])})),l.properties=Object.assign(l.properties,r)})),!1===a&&(o.features=o.features.filter((t=>s.includes(t.properties[e]))))}return o}function H(t,e=1e3,l=5){if(Array.isArray(t)){let r=[];return t.forEach((t=>r.push({type:"layer",geojson:t}))),R({params:{margin:l,width:e},layers:r})}return R({params:{margin:l,width:e},layers:[{type:"layer",geojson:t}]})}function I(t,e,l){return{type:"FeatureCollection",features:t.map((t=>({type:"Feature",properties:t,geometry:{type:"Point",coordinates:[+t[l],+t[e]]}})))}}export{R as draw,G as match,Y as merge,H as quickdraw,I as table2geo};export default null;
