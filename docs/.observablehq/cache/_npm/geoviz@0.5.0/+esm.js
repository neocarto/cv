/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/geoviz@0.5.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{geoEquirectangularRaw,geoBounds,geoArea,geoCentroid,geoIdentity,geoPath,geoMercator,geoNaturalEarth1,geoGraticule,geoEquirectangular,geoProjection}from"../d3-geo@3.1.0/+esm.js";import{create as create$1,select,pointers}from"../d3-selection@3.0.0/+esm.js";import{descending,max,extent as extent$1,min,ascending,sum,cumsum,mean,mode,range}from"../d3-array/+esm.js";import{scaleSqrt,scaleLinear,scaleThreshold,scaleOrdinal}from"../d3-scale@4.0.2/+esm.js";import{forceX,forceY,forceCollide,forceSimulation}from"../d3-force@3.0.0/+esm.js";import{arc}from"../d3-shape@3.2.0/+esm.js";import{tile as tile$1}from"../d3-tile@1.0.0/+esm.js";import*as geoScaleBar from"../d3-geo-scale-bar@1.2.5/+esm.js";import{zoom,zoomTransform,zoomIdentity}from"../d3-zoom@3.0.0/+esm.js";import{interpolate,interpolateRgbBasis}from"../d3-interpolate@3.0.1/+esm.js";import{transition}from"../d3-transition@3.0.1/+esm.js";import versor from"../versor@0.2/+esm.js";import{formatLocale}from"../d3-format@3.1.0/+esm.js";import{geoProject}from"../d3-geo-projection@4.0.0/+esm.js";import*as discr from"../statsbreaks@1.0.6/+esm.js";import{getColors,getPalettes}from"../dicopal@0.6.4/+esm.js";const d3$A=Object.assign({},{geoEquirectangularRaw:geoEquirectangularRaw,geoBounds:geoBounds});function bbox(t){let e;e=Array.isArray(t)?t:d3$A.geoBounds(t);let a=e[0][0],r=e[0][1],i=e[1][0],o=e[1][1];const n={type:"FeatureCollection",features:[{type:"Feature",properties:{id:1},geometry:{type:"Polygon",coordinates:-90===r?[[[a,o],[i,o]]]:[[[a,r],[a,o],[i+=360*(i<a),o],[i,r],[a,r]]]}}]};return inverseResampleJSON(d3$A.geoEquirectangularRaw,.02)(n)}const inverseResampleJSON=(t,e)=>{const a=Math.PI/180,r=Math.tan(a*e/2)**2,i=function(e,a,o,n,l,s,d){if(s--){var c=planar_midpoint(e,o),p=t.invert(...c),h=cartesian(p),u=stereo_length2(h,a),g=stereo_length2(h,n);stereo_area2(h,a,n)*(1+.25*l)*(1+.25*l)/(r*l)+(u-g)/l*2*((u-g)/l)>1&u+g>r|u+g>.25&&(i(e,a,c,h,u,s,d),d.push(p),i(c,h,o,n,g,s,d))}},o=e=>{let a=[],r=e[0],o=t.invert(...r),n=cartesian(o);a.push(o);for(var l=1,s=e.length;l<s;l++){let o=e[l],s=t.invert(...o),d=cartesian(s);i(r,n,o,d,stereo_length2(n,d),16,a),a.push(s),r=o,n=d}return a};let n,l=e=>t.invert(...e),s=t=>e=>e.forEach(((a,r)=>e[r]=t(a))),d={Point:t=>t.coordinates=l(t.coordinates),MultiPoint:t=>s(l)(t.coordinates),LineString:t=>t.coordinates=o(t.coordinates),Polygon:t=>s(o)(t.coordinates),MultiLineString:t=>s(o)(t.coordinates),MultiPolygon:t=>t.coordinates.forEach(s(o)),Feature:t=>n(t.geometry),GeometryCollection:t=>t.geometries.forEach(n),FeatureCollection:t=>t.features.forEach(n)};return n=t=>(d[t.type](t),t),function(t){return t=JSON.parse(JSON.stringify(t)),n(t)}},stereo_area2=([t,e,a],[r,i,o],[n,l,s])=>{var d=t*((i-e)*(s-a)-(l-e)*(o-a))+e*((o-a)*(n-t)-(s-a)*(r-t))+a*((r-t)*(l-e)-(n-t)*(i-e)),c=(t+n)*(t+r)+(e+l)*(e+i)+(a+s)*(a+o);return(d*d+!(c*c))/(c*c)},planar_midpoint=([t,e],[a,r])=>[.5*(t+a),.5*(e+r)],radians=Math.PI/180,cartesian=([t,e])=>[Math.cos(radians*e)*Math.cos(radians*t),Math.cos(radians*e)*Math.sin(radians*t),Math.sin(radians*e)],stereo_length2=([t,e,a],[r,i,o])=>{var n=t*(i-e)-(r-t)*e,l=e*(o-a)-(i-e)*a,s=a*(r-t)-(o-a)*t,d=t*(r+t)+e*(i+e)+a*(o+a);return(n*n+l*l+s*s+!(d*d))/(d*d)};function whatisit(t){return isFeatureCollection(t)?"FeatureCollection":isFeatures(t)?"features":isFeature(t)?"feature":isGeometries(t)?"geometries":isGeometry(t)?"geometry":isArrayOfObjects(t)?"table":isBbox(t)?"bbox":void 0}function isFeatureCollection(t){return"object"==typeof t&&!Array.isArray(t)&&"FeatureCollection"==t.type}function isFeatures(t){return!(!Array.isArray(t)||"Feature"!=t[0]?.type||!t[0].hasOwnProperty("geometry"))}function isFeature(t){return!(Array.isArray(t)||"object"!=typeof t||"Feature"!=t?.type||!t.hasOwnProperty("geometry"))}function isBbox(t){return!!(Array.isArray(t)&&2==t.length&&Array.isArray(t[0])&&Array.isArray(t[1])&&Array.isArray(t[0])&&2==t[0]?.length&&2==t[1]?.length)}function isGeometries(t){return!!(Array.isArray(t)&&t[0].hasOwnProperty("type")&&t[0].hasOwnProperty("coordinates"))}function isGeometry(t){return!Array.isArray(t)&&"object"==typeof t&&t.hasOwnProperty("coordinates"),!(!t.hasOwnProperty("type")||!Array.isArray(t?.coordinates))}function isArrayOfObjects(t){return!(isBbox(t)||!Array.isArray(t)||"object"!=typeof t[0]||0===Object.keys(t[0]).length)}function extent(t,e){if((null==t||""==t)&&"none"!==e)return{type:"Sphere"};if((null==t||""==t)&&"none"==e)return bbox([[0,0],[0,0]]);if("bbox"==whatisit(t))return bbox(t);if("FeatureCollection"==whatisit(t))return t;if(Array.isArray(t)&&1==[...new Set(t.map((t=>whatisit(t))))].length&&"FeatureCollection"==whatisit(t[0])){let e=[];return t.forEach((t=>e.push(t.features))),{type:"FeatureCollection",features:e.flat()}}}const d3$z=Object.assign({},{create:create$1,descending:descending});function unique$1(){let t="";const e="abcdefghijklmnopqrstuvwxyz";for(let a=0;a<15;a++)t+=e.charAt(Math.floor(26*Math.random()));return t}function propertiesentries(t){let e=[];return t.features.map((t=>t.properties)).forEach((t=>e.push(Object.keys(t)))),[...new Set(e.flat())]}function detectinput(t,e=[]){return"function"==typeof t?"function":"string"==typeof t&&e.includes(t)?"field":"value"}function check(t,e){return"function"==typeof t?t:"string"==typeof t&&e.includes(t)?e=>e.properties[t]:t}function getsize$1(t){const e=t.clone(!0),a=d3$z.create("svg");a.node().appendChild(e.node()),document.body.appendChild(a.node());const{x:r,y:i,width:o,height:n}=e.node().getBBox();return document.body.removeChild(a.node()),{x:r,y:i,width:o,height:n}}function camelcasetodash$1(t,e=""){return t.split(/(?=[A-Z])/).map((t=>t.toLowerCase())).join("-").replace(e+"_","")}function northangle(t,e){const a=e.invert(t),r=e([a[0],a[1]+3]),i=e([a[0],a[1]-3]),o=r[0]-i[0],n=i[1]-r[1];let l=Math.atan(o/n)*(180/Math.PI);const s=e([0,90]);return t[1]<s[1]&&(l+=180),l}function implantation(t){let e=Array.from(new Set(t.features.filter((t=>null!==t.geometry)).map((t=>t.geometry.type)))),a=[];return-1===e.indexOf("Polygon")&&-1===e.indexOf("MultiPolygon")||a.push(3),-1===e.indexOf("LineString")&&-1===e.indexOf("MultiLineString")||a.push(2),-1===e.indexOf("Point")&&-1===e.indexOf("MultiPoint")||a.push(1),1==a.length?a[0]:-1}function columns(t){let e=[];return t.forEach((t=>e.push(Object.keys(t)))),[...new Set(e.flat())]}function order(t,e,{fields:a,descending:r=!0}={}){switch(a=a||columns(t.map((t=>t.properties))),detectinput(e,a)){case"value":return t;case"function":return t.sort(e);case"field":return r?t.sort(((t,a)=>d3$z.descending(Math.abs(+t.properties[e]),Math.abs(+a.properties[e])))):t.sort(((t,a)=>d3$z.descending(Math.abs(+a.properties[e]),Math.abs(+t.properties[e]))))}}function isNumber$1(t){return null!==t&&""!==t&&"boolean"!=typeof t&&isFinite(t)}function getDOMids(t){let e=t.selectAll("g"),a=e._groups[0].length,r=[];for(let t=0;t<a;t++)r.push(e.selectAll("id")._parents[t].id);return r.filter((t=>""!==t))}function random(){const t=["#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A","#FFFF99","#B15928","#32A251","#ACD98D","#FF7F0F","#FFB977","#B85A0D","#FFD94A","#39737C","#86B4A9","#82853B","#CCC94D"];return t[Math.floor(Math.random()*t.length)]}const d3$y=Object.assign({},{scaleSqrt:scaleSqrt,max:max,extent:extent$1});function radius(t,{fixmax:e,k:a=50}={}){const r=null!=e?e:d3$y.max(t.map((t=>Math.abs(+t))));return{data:d3$y.extent(t.filter((t=>isNumber$1(t))).map((t=>Math.abs(Number(t))))),k:a,fixmax:e,r:d3$y.scaleSqrt([0,r],[0,a])}}const d3$x=Object.assign({},{forceX:forceX,forceY:forceY,forceCollide:forceCollide,forceSimulation:forceSimulation,max:max,scaleSqrt:scaleSqrt});function dodge(t,{projection:e=(t=>t),iteration:a=200,r:r=10,k:i=50,fixmax:o=null,gap:n=0}={}){let l,s=JSON.parse(JSON.stringify(t)).features.filter((t=>t.geometry)).filter((t=>null!=t.geometry.coordinates)),d=JSON.parse(JSON.stringify(s)),c=propertiesentries(t);if("field"==detectinput(r,c)){const t=null!=o?o:d3$x.max(d,(t=>Math.abs(+t.properties[r])));let a=d3$x.scaleSqrt([0,t],[0,i]);l=d3$x.forceSimulation(d).force("x",d3$x.forceX((t=>e(t.geometry.coordinates)[0]))).force("y",d3$x.forceY((t=>e(t.geometry.coordinates)[1]))).force("collide",d3$x.forceCollide((t=>a(Math.abs(t.properties[r]))+n)))}"function"==detectinput(r,c)&&(l=d3$x.forceSimulation(d).force("x",d3$x.forceX((t=>e(t.geometry.coordinates)[0]))).force("y",d3$x.forceY((t=>e(t.geometry.coordinates)[1]))).force("collide",d3$x.forceCollide(r))),"value"==detectinput(r,c)&&(l=d3$x.forceSimulation(d).force("x",d3$x.forceX((t=>e(t.geometry.coordinates)[0]))).force("y",d3$x.forceY((t=>e(t.geometry.coordinates)[1]))).force("collide",d3$x.forceCollide(r+n)));for(let t=0;t<a;t++)l.tick();return s.map(((t,e)=>t.geometry.coordinates=[d[e].x,d[e].y])),{type:"FeatureCollection",crs:null,features:s}}const d3$w=Object.assign({},{geoArea:geoArea,geoCentroid:geoCentroid,geoIdentity:geoIdentity,geoPath:geoPath});function centroid(t,{largest:e=!0,latlong:a=!0}={}){let r=d3$w.geoPath(d3$w.geoIdentity()),i=JSON.parse(JSON.stringify(t));const o=function(t){var e={},i=0;return t.geometry.coordinates.forEach((function(t){var o={type:"Polygon",coordinates:t},n=a?d3$w.geoArea(o):r.area(o);n>i&&(i=n,e=o)})),e};let n=i.features.filter((t=>null!=t.geometry)).map((t=>(t.geometry.coordinates=a?d3$w.geoCentroid(1==e?"Polygon"==t.geometry.type?t:o(t):t):r.centroid(1==e?"Polygon"==t.geometry.type?t:o(t):t),t.geometry.type="Point",t)));return i.features=n,i}const d3$v=Object.assign({},{select:select,pointers:pointers});function tooltip(layer,data,container,tip,tip_style={},fields){if("string"==typeof tip)fields.sort(((t,e)=>e.length-t.length)),fields.forEach((t=>{tip=tip.replace(`$${t}`,`\${d.properties.${t}}`)})),tip=eval("d => `"+tip+"`");else if("function"==typeof tip){const arrstr=tip.toString().split("=>");arrstr[1].includes("`${")||(tip=eval(arrstr[0]+" => `${"+tip.toString().split("=>")[1]+"}`"))}else if(!0===tip){let x={...data},keys=[];x.features.map((t=>t.properties)).forEach((t=>{keys.push(Object.keys(t))})),keys=Array.from(new Set(keys.flat()));let str=[];keys.forEach((t=>str.push(`${t}: \${d.properties.${t}}`))),tip=eval("(d) => `"+str.join("\n")+"`")}let style={fontSize:13,fill:"#4d4545",background:"#fcf7e6",stroke:"#4a4d4b",strokeWidth:1,fontFamily:container.fontFamily,fontWeight:"normal",fontStyle:"normal",textDecoration:"none",hoverOpacity:.5,hoverFill:void 0,hoverStroke:void 0},formerOpacity=layer.attr("fill-opacity"),context=container.node();Object.keys(tip_style).forEach((t=>{style[t]=tip_style[t]}));const geoviztooltip=container.select("#geoviztooltip");let path,text;geoviztooltip.attr("pointer-events","none"),container.select("#geoviztooltip").selectAll("*").empty()?(path=geoviztooltip.append("g").attr("id","geotooltippath").attr("fill",style.background).attr("stroke",style.stroke).attr("stroke-width",style.strokeWidth).selectAll("path").data([null]).join("path"),text=geoviztooltip.append("g").attr("id","geotooltiptext").attr("font-size",`${style.fontSize}px`).attr("fill",style.fill).attr("font-family",style.fontFamily).attr("font-weight",style.fontWeight).attr("font-style",style.fontStyle).attr("text-decoration",style.textDecoration)):(path=geoviztooltip.select("#geotooltippath").attr("fill",style.background).attr("stroke",style.stroke).attr("stroke-width",style.strokeWidth).selectAll("path").data([null]).join("path"),text=geoviztooltip.select("#geotooltiptext")),layer.selectAll("*").on("touchmove mousemove",(function(event,d){geoviztooltip.style("visibility","visible");const xy=d3$v.pointers(event,context)[0];d3$v.select(this).attr("fill-opacity",.5),text.selectAll("text").data(eval(tip.toString().split("=>")[1]).split("\n")).join("text").attr("dy",((t,e)=>e*style.fontSize)).text((t=>t)),path.attr("transform",`translate(${xy})`);const{x:x,y:y,width:w,height:h}=text.node().getBBox(),x_margin=.33*container.width,y_margin=.25*container.height;xy[0]<x_margin&&xy[1]<y_margin?(text.attr("transform",`translate(${xy[0]+10},${xy[1]+15-y})`),path.attr("d",`M0,0v${+h+5+20}h${w+20}v${-h-20}h${-w-15}z`)):xy[0]>container.width-x_margin&&xy[1]<y_margin?(text.attr("transform",`translate(${xy[0]-w-10},${xy[1]+15-y})`),path.attr("d",`M0,0v${+h+5+20}h${-w-20}v${-h-20}h${+w+15}z`)):xy[0]<x_margin&&xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]+10},${xy[1]-15-y-h})`),path.attr("d",`M0,0v${-h-5-20}h${w+20}v${h+20}h${-w-15}z`)):xy[0]>container.width-x_margin&&xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]-w-10},${xy[1]-15-y-h})`),path.attr("d",`M0,0v${-h-5-20}h${-w-20}v${h+20}h${w+15}z`)):xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]-w/2},${xy[1]-15-y-h})`),path.attr("d",`M${-w/2-10},-5H-5l5,5l5,-5H${w/2+10}v${-h-20}h-${w+20}z`)):xy[0]<x_margin?(text.attr("transform",`translate(${xy[0]+15},${xy[1]-y-h/2})`),path.attr("d",`M0,0l5,5v${h/2+5}h${w+20}v${-h-20}h${-w-20}v${h/2+5}z`)):xy[0]>container.width-x_margin?(text.attr("transform",`translate(${xy[0]-w-15},${xy[1]-y-h/2})`),path.attr("d",`M0,0l-5,5v${h/2+5}h${-w-20}v${-h-20}h${w+20}v${h/2+5}z`)):(text.attr("transform",`translate(${xy[0]-w/2},${xy[1]-y+15})`),path.attr("d",`M${-w/2-10},5H-5l5,-5l5,5H${w/2+10}v${h+20}h-${w+20}z`))})).on("touchend mouseleave",(function(t,e){d3$v.select(this).attr("fill-opacity",formerOpacity),geoviztooltip.style("visibility","hidden")}))}const d3$u=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity});function circle(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({zoomable:!0,domain:t.data,control:!1,projection:"none"}):t;let i={...{mark:"circle",id:unique$1(),data:void 0,r:10,k:50,pos:[0,0],sort:void 0,dodge:!1,dodgegap:0,iteration:200,descending:!0,fixmax:null,fill:random(),stroke:"white",tip:void 0,tipstyle:void 0},...a?t:e},o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),i.data||(i.coords=void 0!==i.coords?i.coords:"svg"),i.data&&(r.data=!0,i.coords=void 0!==i.coords?i.coords:"geo",i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","coords","data","r","k","sort","dodge","dodgegap","iteration","descending","fixmax","tip","tipstyle","pos"].includes(t)));let l="svg"==i.coords?d3$u.geoIdentity():r.projection,s=d3$u.geoPath(l);if(i.data){i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data;let t=propertiesentries(i.data);const e=n.filter((e=>"value"==detectinput(i[e],t)));e.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));const a=n.filter((t=>!e.includes(t)));a.forEach((e=>{i[e]=check(i[e],t)}));let l,d="svg"==i.coords?d3$u.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection;if(i.dodge){l=JSON.parse(JSON.stringify(i.data));let t={features:l.features.filter((t=>!isNaN(d3$u.geoPath(d).centroid(t.geometry)[0]))).filter((t=>!isNaN(d3$u.geoPath(d).centroid(t.geometry)[1])))};l=dodge(t,{projection:d,gap:i.dodgegap,r:i.r,k:i.k,fixmax:i.fixmax,iteration:i.iteration}),d=d3$u.geoIdentity()}else l=i.data;let c=propertiesentries(i.data),p=attr2radius$1(i.r,{columns:c,geojson:i.data,fixmax:i.fixmax,k:i.k});l=l.features.filter((t=>t.geometry)).filter((t=>null!=t.geometry.coordinates)),"field"==detectinput(i.r,c)&&(l=l.filter((t=>null!=t.properties[i.r]))),l=order(l,i.sort||i.r,{fields:c,descending:i.descending}),s=d3$u.geoPath(d),o.selectAll("circle").data(l).join((t=>{let e=t.append("circle").attr("cx",(t=>s.centroid(t.geometry)[0])).attr("cy",(t=>s.centroid(t.geometry)[1])).attr("r",(t=>p(t,i.r))).attr("visibility",(t=>isNaN(s.centroid(t.geometry)[0])?"hidden":"visible"));return a.forEach((t=>{e.attr(camelcasetodash$1(t),i[t])})),e})),i.tip&&tooltip(o,i.data,r,i.tip,i.tipstyle,t)}else{n.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));let t=s.centroid({type:"Point",coordinates:i.pos});o.append("circle").attr("cx",t[0]).attr("cy",t[1]).attr("r",i.r).attr("visibility",isNaN(t[0])?"hidden":"visible")}if(a){const t=getsize$1(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function attr2radius$1(t,{columns:e,geojson:a,fixmax:r,k:i}={}){switch(detectinput(t,e)){case"function":return t;case"field":let e=radius(a.features.map((e=>e.properties[t])),{fixmax:r,k:i});return(t,a)=>e.r(t.properties[a]);case"value":return e=>t}}const d3$t=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity,arc:arc});function halfcircle(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({zoomable:!0,domain:t.data,control:!1,projection:"none"}):t;let i={...{mark:"halfcircle",id:unique$1(),data:void 0,r:20,k:50,pos:[0,0],dx:0,dy:0,cornerRadius:2,innerRadius:0,angle:0,sort:void 0,descending:!0,fixmax:null,fill:random(),stroke:"white",tip:void 0,tipstyle:void 0},...a?t:e},o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),i.data||(i.coords=void 0!==i.coords?i.coords:"svg"),i.data&&(i.coords=void 0!==i.coords?i.coords:"geo",i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","coords","data","r","k","dx","dy","cornerRadius","innerRadius","transform","angle","sort","descending","fixmax","tip","tipstyle","pos"].includes(t)));if(i.data){let t="svg"==i.coords?d3$t.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection,e=d3$t.geoPath(t);i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data;let a=propertiesentries(i.data);const l=n.filter((t=>"value"==detectinput(i[t],a)));l.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));const s=n.filter((t=>!l.includes(t)));s.forEach((t=>{i[t]=check(i[t],a)})),"svg"==i.coords?d3$t.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection;let d=i.data,c=propertiesentries(d),p=attr2radius(i.r,{columns:c,geojson:i.data,fixmax:i.fixmax,k:i.k});d=d.features.filter((t=>t.geometry)).filter((t=>null!=t.geometry.coordinates)),"field"==detectinput(i.r,c)&&(d=d.filter((t=>null!=t.properties[i.r]))),d=order(d,i.sort||i.r,{fields:c,descending:i.descending}),o.selectAll("path").data(d).join((t=>{let a=t.append("path").attr("transform",(t=>`rotate(${i.angle} ${e.centroid(t.geometry)[0]+i.dx} ${e.centroid(t.geometry)[1]+i.dy}) translate(${e.centroid(t.geometry)[0]+i.dx} ${e.centroid(t.geometry)[1]+i.dy})`)).attr("d",(t=>d3$t.arc().outerRadius(p(t,i.r)).innerRadius(i.innerRadius).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.cornerRadius)())).attr("visibility",(t=>isNaN(e.centroid(t.geometry)[0])?"hidden":"visible"));return s.forEach((t=>{a.attr(camelcasetodash$1(t),i[t])})),a})),i.tip&&tooltip(o,i.data,r,i.tip,i.tipstyle,a)}else{let t="svg"==i.coords?d3$t.geoIdentity():r.projection,e=d3$t.geoPath(t);n.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));let a=e.centroid({type:"Point",coordinates:i.pos});o.append("path").attr("transform",`rotate(${i.angle} ${a[0]+i.dx} ${a[1]+i.dy}) translate(${a[0]+i.dx} ${a[1]+i.dy})`).attr("d",d3$t.arc().outerRadius(i.r).innerRadius(i.innerRadius).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.cornerRadius)()).attr("visibility",isNaN(a[0])?"hidden":"visible")}if(a){const t=getsize$1(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function attr2radius(t,{columns:e,geojson:a,fixmax:r,k:i}={}){switch(detectinput(t,e)){case"function":return t;case"field":let e=radius(a.features.map((e=>e.properties[t])),{fixmax:r,k:i});return(t,a)=>e.r(t.properties[a]);case"value":return e=>t}}const d3$s=Object.assign({},{scaleLinear:scaleLinear,max:max,extent:extent$1});function height(t,{fixmax:e,k:a=50}={}){const r=null!=e?e:d3$s.max(t.map((t=>Math.abs(+t))));return{data:d3$s.extent(t.filter((t=>isNumber$1(t))).map((t=>Math.abs(Number(t))))),k:a,fixmax:e,h:d3$s.scaleLinear().domain([0,r]).range([0,a]).unknown(0)}}const d3$r=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity});function spike(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({zoomable:!0,control:!1,domain:t.data,projection:"none"}):t;let i={...{mark:"spike",id:unique$1(),data:void 0,pos:[0,0],k:50,width:30,height:100,pos:[0,0],straight:0,sort:void 0,descending:!0,fixmax:null,fill:"#F13C47",stroke:"#F13C47",fillOpacity:.5,strokeWidth:.5,tip:void 0,tipstyle:void 0},...a?t:e},o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),i.data||(i.coords=void 0!==i.coords?i.coords:"svg"),i.data&&(r.data=!0,i.coords=void 0!==i.coords?i.coords:"geo",i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","coords","data","height","width","k","sort","descending","fixmax","tip","tipstyle","pos"].includes(t)));if(i.data){let t="svg"==i.coords?d3$r.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection,e=d3$r.geoPath(t);i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords&&trueg}):i.data;let a=propertiesentries(i.data);const l=n.filter((t=>"value"==detectinput(i[t],a)));l.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));const s=n.filter((t=>!l.includes(t)));s.forEach((t=>{i[t]=check(i[t],a)}));let d=i.data,c=propertiesentries(d);let p;switch(detectinput(i.height,c)){case"value":p=t=>`m ${e.centroid(t.geometry)[0]-i.width/2},${e.centroid(t.geometry)[1]} Q ${e.centroid(t.geometry)[0]},${e.centroid(t.geometry)[1]-i.height*i.straight},${e.centroid(t.geometry)[0]} ${e.centroid(t.geometry)[1]-i.height}\n         Q ${e.centroid(t.geometry)[0]}, ${e.centroid(t.geometry)[1]-i.height*i.straight} ${e.centroid(t.geometry)[0]+i.width/2},${e.centroid(t.geometry)[1]}`;break;case"field":const t=height(d.features.map((t=>t.properties[i.height])),{fixmax:i.fixmax,k:i.k}).h;p=a=>`m ${e.centroid(a.geometry)[0]-i.width/2},${e.centroid(a.geometry)[1]} Q ${e.centroid(a.geometry)[0]},${e.centroid(a.geometry)[1]-t(a.properties[i.height])*i.straight},${e.centroid(a.geometry)[0]} ${e.centroid(a.geometry)[1]-t(a.properties[i.height])}\n         Q ${e.centroid(a.geometry)[0]}, ${e.centroid(a.geometry)[1]-t(a.properties[i.height])*i.straight} ${e.centroid(a.geometry)[0]+i.width/2},${e.centroid(a.geometry)[1]}`}d=d.features.filter((t=>t.geometry)).filter((t=>null!=t.geometry.coordinates)),"field"==detectinput(i.height,c)&&(d=d.filter((t=>null!=t.properties[i.height]))),d=order(d,i.sort||i.height,{fields:c,descending:i.descending}),o.selectAll("path").data(d).join((t=>{let a=t.append("path").attr("d",p).attr("visibility",(t=>isNaN(e.centroid(t.geometry)[0])?"hidden":"visible"));return s.forEach((t=>{a.attr(camelcasetodash$1(t),i[t])})),a})),i.tip&&tooltip(o,i.data,r,i.tip,i.tipstyle,a)}else{let t="svg"==i.coords?d3$r.geoIdentity():r.projection,e=d3$r.geoPath(t);n.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));let a=e.centroid({type:"Point",coordinates:i.pos});o.append("path").attr("d",`m ${a[0]-i.width/2},${a[1]} Q ${a[0]},${a[1]-i.height*i.straight},${a[0]} ${a[1]-i.height}\n     Q ${a[0]}, ${a[1]-i.height*i.straight} ${a[0]+i.width/2},${a[1]}`).attr("visibility",isNaN(a[0])?"hidden":"visible")}if(a){const t=getsize$1(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$q=Object.assign({},{geoPath:geoPath,geoIdentity:geoIdentity,geoCentroid:geoCentroid});function text(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({zoomable:!0,control:!1,domain:t.data||t.datum,projection:"none"}):t;let i={...{mark:"text",id:unique$1(),strokeWidth:1,text:"text",sort:void 0,descending:!0,paintOrder:"stroke",strokeLinejoin:"round",fontSize:12,lineSpacing:0,fontFamily:r.fontFamily,dx:0,dy:0,pos:[0,0]},...a?t:e};i.data||(i.coords=void 0!==i.coords?i.coords:"svg","svg"!==i.coords?(i.dominantBaseline=i.dominantBaseline?i.dominantBaseline:"middle",i.textAnchor=i.textAnchor?i.textAnchor:"middle"):(i.dominantBaseline=i.dominantBaseline?i.dominantBaseline:"hanging",i.textAnchor=i.textAnchor?i.textAnchor:"start")),i.data&&(r.data=!0,i.coords=void 0!==i.coords?i.coords:"geo",i.textAnchor=i.textAnchor?i.textAnchor:"middle",i.dominantBaseline=i.dominantBaseline?i.dominantBaseline:"middle",i.data=3==implantation(i.data)?centroid(i.data,{latlong:"none"!=r.initproj&&"svg"!=i.coords}):i.data);let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","datum","data","coords","sort","descending"].includes(t)));if(!i.data){let t="svg"==i.coords?d3$q.geoIdentity():r.projection,e=d3$q.geoPath(t);n.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));let a=e.centroid({type:"Point",coordinates:i.pos});if(a[0]=a[0]+i.dx,a[1]=a[1]+i.dy,1==i.text.split("\n").length)o.append("text").attr("x",a[0]).attr("y",a[1]).text(i.text).attr("visibility",isNaN(a[0])?"hidden":"visible");else{let t=0;switch(i.dominantBaseline){case"hanging":default:t=0;break;case"middle":case"central":t=(i.text.split("\n").length-1)*i.fontSize,t/=2;break;case"auto":case"text-top":t=(i.text.split("\n").length-1)*i.fontSize}o.selectAll("text").data(i.text.split("\n")).join("text").attr("x",a[0]).attr("y",((e,r)=>a[1]+r*(i.fontSize+i.lineSpacing)-t)).text((t=>t)).attr("visibility",isNaN(a[0])?"hidden":"visible")}}if(i.data){let t="svg"==i.coords?d3$q.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection,e=d3$q.geoPath(t),a=propertiesentries(i.data);const l=n.filter((t=>"value"==detectinput(i[t],a)));l.forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));const s=n.filter((t=>!l.includes(t)));s.forEach((t=>{i[t]=check(i[t],a)}));let d=i.data.features.filter((t=>t.geometry)).filter((t=>null!=t.geometry.coordinates));d=order(d,i.sort,{fields:a,descending:i.descending}),o.selectAll("text").data(d).join((t=>{let a=t.append("text").attr("x",(t=>e.centroid(t.geometry)[0])).attr("y",(t=>e.centroid(t.geometry)[1])).text(i.text).attr("visibility",(t=>isNaN(e.centroid(t.geometry)[0])?"hidden":"visible"));return s.forEach((t=>{a.attr(camelcasetodash$1(t),i[t])})),a}))}if(a){const t=getsize$1(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function tile(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({projection:geoMercator(),zoomable:!0}):t;let i={...{mark:"tile",id:unique$1(),tileSize:512,zoomDelta:1,increasetilesize:1,opacity:1,clipPath:void 0,url:(t,e,a)=>`https://tile.openstreetmap.org/${a}/${t}/${e}.png`},...a?t:e};i.url=geturl(i.url),"none"==r.initproj&&r.warning&&r.warning_message.push('You must use projection: "mercator" in the svg container to display tile marks');let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);let n=tile$1().size([r.width,r.height]).scale(2*r.projection.scale()*Math.PI).translate(r.projection([0,0])).tileSize(i.tileSize).zoomDelta(i.zoomDelta);return o.selectAll("image").data(n()).join("image").attr("xlink:href",(t=>i.url(...t))).attr("x",(([t])=>(t+n().translate[0])*n().scale)).attr("y",(([,t])=>(t+n().translate[1])*n().scale)).attr("width",n().scale+i.increasetilesize+"px").attr("height",n().scale+i.increasetilesize+"px").attr("opacity",i.opacity).attr("clip-path",i.clipPath),a?render(r):`#${i.id}`}function geturl(t){let e=(t,e,a)=>`https://tile.openstreetmap.org/${a}/${t}/${e}.png`;switch(typeof t){case"function":e=t;break;case"string":e=providers.find((e=>e.name==t))?.url||((t,e,a)=>`https://tile.openstreetmap.org/${a}/${t}/${e}.png`)}return e}const providers=[{name:"openstreetmap",provider:"OpenStreetMap contributors",url:(t,e,a)=>`https://tile.openstreetmap.org/${a}/${t}/${e}.png`},{name:"opentopomap",provider:"OpenStreetMap contributors",url:(t,e,a)=>`https://tile.opentopomap.org/${a}/${t}/${e}.png`},{name:"worldterrain",provider:"USGS, Esri, TANA, DeLorme, and NPS",url:(t,e,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/${a}/${e}/${t}.png`},{name:"worldimagery",provider:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",url:(t,e,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/${a}/${e}/${t}.png`},{name:"worldStreet",provider:"Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012",url:(t,e,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/${a}/${e}/${t}.png`},{name:"worldphysical",provider:"Esri, US National Park Service",url:(t,e,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/${a}/${e}/${t}`},{name:"shadedrelief",provider:"ESRI",url:(t,e,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/${a}/${e}/${t}.png`}],d3$p=Object.assign({},geoScaleBar);function scalebar(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i={...{mark:"scalebar",id:unique$1(),pos:[10,r.height-20],translate:null,units:"km",label:void 0,tickPadding:5,tickSize:.2,distance:void 0,tickFormat:t=>t,tickValues:void 0,labelAnchor:"start"},...a?t:e};"none"==r.initproj&&r.warning&&(r.warning_message.push("Scalebar mark"),r.warning_message.push("The scale bar is not relevant without defining a projection function function in the SVG container"));let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);Object.entries(i).map((t=>t[0])).forEach((t=>{o.attr(camelcasetodash$1(t),i[t])}));let n=new Map([["ft",d3$p.geoScaleFeet],["km",d3$p.geoScaleKilometers],["m",d3$p.geoScaleMeters],["mi",d3$p.geoScaleMiles]]).get(i.units);const l=i.pos[0]/r.width,s=i.pos[1]/r.height,d=d3$p.geoScaleBar().projection(r.projection).size([r.width,r.height]).left(l).top(s).distance(i.distance).label(void 0!==i.label?i.label:n.units).units(n).tickPadding(i.tickPadding).tickSize(i.tickSize).tickFormat(i.tickFormat).tickValues(i.tickValues).labelAnchor(i.labelAnchor);return o.call(d),i.translate&&o.attr("transform",`translate(${i.pos[0]+i.translate[0]},${i.pos[1]+i.translate[1]})`),a?render(r):`#${i.id}`}function north(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i={...{mark:"north",id:unique$1(),pos:[r.width-30,30],rotate:null,scale:1,fill:"black",fillOpacity:1},...a?t:e};"none"==r.initproj&&r.warning&&(r.warning_message.push("North mark"),r.warning_message.push("The North arrow is not relevant without defining a projection function in the SVG container"));let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]=i}else r.zoomablelayers.push(i);const n=null===i.rotate?northangle(i.pos,r.projection):i.rotate;return Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","pos","rotate","scale"].includes(t))).forEach((t=>{o.attr(camelcasetodash$1(t),i[t])})),o.append("path").attr("d","M 0.044958496 -17.812349 C -0.26996119 -17.812349 -0.55343697 -17.592424 -0.67127686 -17.257345 L -8.3333415 4.589384 C -8.4444814 4.9067336 -8.3867007 5.2688235 -8.1855469 5.5205933 C -8.036827 5.7055621 -7.8301427 5.8063639 -7.6176229 5.8063639 C -7.541523 5.8063639 -7.4648555 5.7942066 -7.3902466 5.7676066 C -2.7097153 4.1075403 2.3000786 4.1096862 7.5003174 5.7743245 C 7.7838471 5.8647245 8.0866488 5.7625043 8.2826986 5.5112915 C 8.4787474 5.2601218 8.5328574 4.9026136 8.4232585 4.589384 L 0.76119385 -17.257345 C 0.64335397 -17.592424 0.35987718 -17.812349 0.044958496 -17.812349 z M 0.050126139 -14.540715 L 6.4238973 3.6313029 C 6.4089973 3.6273029 6.393912 3.6251008 6.378422 3.6204508 C 0.64157284 -2.0936385 0.097483092 -4.360355 0.050126139 -14.540715 z M -3.3693034 -12.968201 C -9.1352526 -11.453015 -13.401249 -6.1970669 -13.401249 0.03824056 C -13.401249 4.5709812 -11.148377 8.6866709 -7.540625 11.145056 A 8.3801446 8.3801446 0 0 1 -7.0967244 10.275342 C -10.385638 7.9859154 -12.4349 4.2025426 -12.4349 0.03824056 C -12.4349 -5.659418 -8.5956532 -10.47465 -3.3693034 -11.964128 L -3.3693034 -12.968201 z M 3.5574056 -12.940812 L 3.5574056 -11.936739 C 8.7345144 -10.415833 12.526367 -5.6244081 12.526367 0.03824056 C 12.526367 4.1909026 10.478884 7.9752639 7.19646 10.26759 A 8.3801446 8.3801446 0 0 1 7.6558634 11.126453 C 11.247977 8.6637544 13.492716 4.5522912 13.492716 0.03824056 C 13.492716 -6.161767 9.2740539 -11.392436 3.5574056 -12.940812 z M -3.6158 7.7333781 C -3.7267299 7.7341681 -3.8385828 7.7529054 -3.9475627 7.7897054 C -4.3841612 7.9364343 -4.6793009 8.3455548 -4.6793009 8.8072144 L -4.6793009 18.45262 C -4.6793009 19.045959 -4.1988131 19.526457 -3.6054647 19.526457 C -3.0121153 19.526457 -2.5321452 19.045959 -2.5321452 18.45262 L -2.5321452 12.003918 L 2.8411702 19.10116 C 3.04802 19.374569 3.3674991 19.526973 3.6974487 19.526973 C 3.8112586 19.526973 3.9261433 19.508463 4.0385132 19.471163 C 4.4758327 19.324443 4.7702515 18.914787 4.7702515 18.453137 L 4.7702515 8.8072144 C 4.7702515 8.2138749 4.2890446 7.7338949 3.6964152 7.7338949 C 3.1037968 7.7338949 2.6230957 8.2138749 2.6230957 8.8072144 L 2.6230957 15.25695 L -2.7502197 8.1597087 C -2.9590285 7.8833089 -3.2829703 7.7303491 -3.6158 7.7333781 z ").attr("transform",`translate(${i.pos[0]},${i.pos[1]}) rotate(${n}) scale(${i.scale})`),a?render(r):`#${i.id}`}function zoompanel(t){const e=[25,70],a=e[1]/3;let r=`translate(${t.width-30},5)`;Array.isArray(t.control)&&(r=`translate(${t.control[0]},${t.control[1]})`);const i=t.append("g").attr("transform",r).attr("id",t.controlid);i.append("rect").attr("x",0).attr("y",0).attr("ry",4).attr("height",e[1]).attr("width",e[0]).attr("fill","white").attr("stroke","#6a6a6a").attr("stroke-width",.5).attr("stroke-opacity",.3).attr("fill-opacity",.8),i.append("line").attr("x1",5).attr("y1",a).attr("x2",e[0]-5).attr("y2",a).attr("stroke","#6a6a6a").attr("stroke-opacity",.3).attr("stroke-width",1).attr("stroke-dasharray",2),i.append("line").attr("x1",5).attr("y1",2*a).attr("x2",e[0]-5).attr("y2",2*a).attr("stroke","#6a6a6a").attr("stroke-opacity",.3).attr("stroke-width",1).attr("stroke-dasharray",2);const o=i.append("g").attr("id","plus").attr("fill-opacity",.3).attr("transform",`translate(${e[0]/2},${a/2})`).append("path").attr("d","m 5.3946396,1.8575e-4 c 0,-0.5977207 -0.6415104,-1.07903965 -1.4384715,-1.07903965 H 1.078854 v -2.876943 c 0,-0.7969611 -0.4813189,-1.4388425 -1.0790396,-1.4388425 -0.5977206,0 -1.078668,0.6418815 -1.078668,1.4388425 v 2.876943 h -2.8773145 c -0.7969611,0 -1.4384715,0.48131895 -1.4384715,1.07903965 0,0.5977206 0.6415104,1.07866755 1.4384715,1.07866755 h 2.8773145 v 2.8773148 c 0,0.7969609 0.4809474,1.4384713 1.078668,1.4384713 0.5977207,0 1.0790396,-0.6415104 1.0790396,-1.4384713 V 1.0788533 h 2.8773141 c 0.7969611,0 1.4384715,-0.48094695 1.4384715,-1.07866755 z"),n=i.append("g").attr("id","minus").attr("fill-opacity",.3).attr("transform",`translate(${e[0]/2},${1.5*a})`).append("path").attr("d","m -3.9574147,-1.0788543 h 7.9148294 c 0.767531,0 1.385435,0.48116901 1.385435,1.0788543 0,0.59768529 -0.617904,1.0788543 -1.385435,1.0788543 h -7.9148294 c -0.767531,0 -1.385435,-0.48116901 -1.385435,-1.0788543 0,-0.59768529 0.617904,-1.0788543 1.385435,-1.0788543 z"),l=i.append("g").attr("id","reset").attr("fill-opacity",.3).attr("transform",`translate(${e[0]/2},${2.5*a})`).append("path").attr("d","M -1.2940927,5.0777775 C -2.1684164,4.8314706 -3.2986963,4.0441048 -3.8430923,3.3020874 -4.6193793,2.2440057 -5.0578621,0.46159635 -4.6437431,0.04747726 c 0.4578187,-0.45781851 1.1277698,-0.19372689 1.1277698,0.44454944 0,0.8074783 0.4120423,1.7461873 1.0437767,2.3779217 C -0.24540433,5.0967408 3.4868355,3.5629027 3.4982525,0.41627457 3.5037957,-1.1038637 2.4692459,-2.4802179 1.0001263,-2.9073051 0.19813045,-3.1404538 -0.76260136,-3.0858393 -1.3593238,-2.7731864 l -0.3688394,0.1932514 0.5293829,0.085502 c 0.2911585,0.047005 0.61875041,0.1329827 0.72797943,0.191032 0.29382183,0.1561282 0.3156994,0.71991 0.0377042,0.9714962 -0.21116559,0.1911111 -0.41243343,0.201125 -1.69434973,0.084313 -1.962603,-0.1788514 -1.9446809,-0.1582157 -1.7693199,-2.0361648 0.1718494,-1.8401839 0.5119549,-2.3182208 1.1765397,-1.6536359 0.2143098,0.2143099 0.249689,0.3691038 0.1815992,0.7948485 l -0.084551,0.5287012 0.7756978,-0.3551263 c 1.47661618,-0.6760186 3.3900398,-0.4384785 4.7528368,0.590034 2.9090907,2.1955084 2.3838296,6.6728784 -0.9625575,8.204904 -0.890169,0.4075321 -2.29594186,0.5169037 -3.2368994,0.2518292 z");i.append("g").attr("id","buttonplus").append("rect").attr("x",0).attr("y",0).attr("height",e[1]/3).attr("width",e[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(t=>{o.attr("fill-opacity",.8)})).on("mouseout",(t=>{o.attr("fill-opacity",.3)})),i.append("g").attr("id","buttonminus").append("rect").attr("x",0).attr("y",a).attr("height",e[1]/3).attr("width",e[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(t=>{n.attr("fill-opacity",.8)})).on("mouseout",(t=>{n.attr("fill-opacity",.3)})),i.append("g").attr("id","buttonreset").append("rect").attr("x",0).attr("y",2*a).attr("height",e[1]/3).attr("width",e[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(t=>{l.attr("fill-opacity",.8)})).on("mouseout",(t=>{l.attr("fill-opacity",.3)}))}const d3$o=Object.assign({},{transition:transition,interpolate:interpolate,zoom:zoom,geoPath:geoPath,geoIdentity:geoIdentity,zoomTransform:zoomTransform,select:select});function zoomandpan(t){let e=d3$o.geoIdentity();const a=d3$o.geoPath(t.projection),r=d3$o.geoPath(e);function i(a){const r=Array.isArray(t.zoomable)?t.zoomable:[1,8],i=[t.width/2,t.height/2],o=d3$o.zoomTransform(t.node());if(o.k<=r[1]&&o.k>=r[0]){const l={...o};l.k=o.k*(1+.2*a),l.k=l.k<r[0]?r[0]:l.k,l.k=l.k>r[1]?r[1]:l.k;const s=[(i[0]-o.x)/o.k,(i[1]-o.y)/o.k];l.x+=i[0]-(s[0]*l.k+l.x),l.y+=i[1]-(s[1]*l.k+l.y),o.k=l.k,o.x=l.x,o.y=l.y,t.projection.scale(o.k*t.baseScale).translate([t.baseTranslate[0]*o.k+o.x,t.baseTranslate[1]*o.k+o.y]),e.scale(o.k).translate([o.x,o.y]),t.zoom={k:o.k,x:o.x,y:o.y},n(o)}}function o(){d3$o.zoomTransform(this).k=1,d3$o.zoomTransform(this).x=0,d3$o.zoomTransform(this).y=0,t.projection.scale(t.baseScale).translate(t.baseTranslate),e.scale(1).translate([0,0]),n({k:1,x:0,y:0})}function n(e){t.zoomablelayers.forEach((i=>{switch(i.mark){case"circle":i.zoom={k:e.k,x:e.x,y:e.y},circle(t,i);break;case"halfcircle":i.zoom={k:e.k,x:e.x,y:e.y},halfcircle(t,i);break;case"spike":i.zoom={k:e.k,x:e.x,y:e.y},spike(t,i);break;case"path":t.selectAll(`#${i.id} > path`).attr("d","svg"==i.coords?r:a);break;case"clippath":case"graticule":t.selectAll(`#${i.id} > path`).attr("d",a);break;case"text":i.zoom={k:e.k,x:e.x,y:e.y},text(t,i);break;case"outline":t.selectAll(`#${i.id} > path`).attr("d",a({type:"Sphere"}));break;case"tile":tile(t,i);break;case"scalebar":scalebar(t,i);break;case"north":north(t,i)}}))}t.control?(zoompanel(t),t.select("#buttonplus").on("click",o).on("click",(t=>{i(1)})).on("dblclick",(t=>{t.stopPropagation()})),t.select("#buttonminus").on("click",o).on("click",(t=>{i(-1)})).on("dblclick",(t=>{t.stopPropagation()})),t.select("#buttonreset").on("click",o).on("dblclick",(t=>{t.stopPropagation()}))):t.on("click",o),t.call(d3$o.zoom().extent([[0,0],[t.width,t.height]]).scaleExtent(Array.isArray(t.zoomable)?t.zoomable:[1,8]).on("start",(()=>{t.select("#geoviztooltip").style("visibility","hidden")})).on("zoom",(function({transform:a}){t.projection.scale(a.k*t.baseScale).translate([t.baseTranslate[0]*a.k+a.x,t.baseTranslate[1]*a.k+a.y]),e.scale(a.k).translate([a.x,a.y]),t.zoom={k:a.k,x:a.x,y:a.y},n(a)})))}const d3$n=Object.assign({},geoScaleBar,{zoom:zoom,zoomIdentity:zoomIdentity,pointers:pointers,geoPath:geoPath,geoIdentity:geoIdentity,select:select,scaleLinear:scaleLinear,max:max});function zoomversor(t){function e(){t.zoomablelayers.forEach((e=>{const a=d3$n.geoPath(t.projection);switch(e.mark){case"circle":circle(t,e);break;case"halfcircle":halfcircle(t,e);break;case"spike":spike(t,e);break;case"path":case"clippath":case"graticule":t.selectAll(`#${e.id} > path`).attr("d",a);break;case"text":text(t,e);break;case"outline":t.selectAll(`#${e.id} > path`).attr("d",a({type:"Sphere"}));break;case"tile":tile(t,e);break;case"scalebar":scalebar(t,e);break;case"north":north(t,e)}}))}t.call(versorzoom(t.projection).on("zoom.render end.render",e)).call(e).node()}function versorzoom(t,{scale:e=(void 0===t._scale?t._scale=t.scale():t._scale),scaleExtent:a=[.8,8]}={}){let r,i,o,n,l;const s=d3$n.zoom().scaleExtent(a.map((t=>t*e))).on("start",c).on("zoom",(function(e){t.scale(e.transform.k);const a=d(e,this),l=versor.cartesian(t.rotate(o).invert(a)),s=versor.delta(r,l);let p=versor.multiply(i,s);if(a[2]){const t=(a[2]-n)/2,e=-Math.sin(t),r=Math.sign(Math.cos(t));p=versor.multiply([Math.sqrt(1-e*e),0,0,r*e],p)}t.rotate(versor.rotation(p)),s[0]<.7&&c.call(this,e)}));function d(t,e){const a=d3$n.pointers(t,e);return a.length!==l&&(l=a.length,l>1&&(n=Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0])),c.call(e,t)),l>1?[d3$n.mean(a,(t=>t[0])),d3$n.mean(a,(t=>t[1])),Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0])]:a[0]}function c(e){r=versor.cartesian(t.invert(d(e,this))),i=versor(o=t.rotate())}return Object.assign((e=>e.property("__zoom",d3$n.zoomIdentity.scale(t.scale())).call(s)),{on(t,...e){return e.length?(s.on(t,...e),this):s.on(t)}})}const d3$m=Object.assign({},{select:select,pointers:pointers});function render(t,{order:e=[]}={}){if(e.length>0&&(e=e.flat(),getDOMids(t).toString()!==e&&e.forEach((e=>{t.select(`${e}`).raise()}))),t.data&&"none"==t.initproj&&!t.domain&&t.warning&&t.warning_message.push("You must specify a projection and/or the domain in the SVG container"),t.warning&&t.warning_message.length>0){let e={fontSize:13,fill:"#594A2F",background:"#FDD66C",stroke:"#FDD66C",strokeWidth:1},a=t.append("g").attr("id","warningtooltip").attr("pointer-events","none").style("visibility","hidden").attr("transform","translate(30,10)");const r=t.warning_message.length*e.fontSize,i=t.width-80;a.append("g").attr("fill",e.background).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth).append("path").attr("d",`M0,0v${+r+5+20}h${i+20}v${-r-20}h${-i-15}z`).attr("transform","translate(-10,20)"),a.append("g").attr("font-size",`${e.fontSize}px`).attr("fill",e.fill).attr("font-family",e.fontFamily).attr("text-anchor","middle").attr("font-weight","bold").attr("transform",`translate(${(t.width-70)/2},45)`).selectAll("text").data(t.warning_message).join("text").attr("dy",((t,a)=>a*e.fontSize)).text((t=>t)),t.append("g").attr("font-size","15px").append("text").attr("x",10).attr("y",20).text("⚠️").on("touchmove mousemove",(function(t,e){d3$m.select(this).style("cursor","pointer"),a.style("visibility","visible")})).on("touchend mouseleave",(function(){a.style("visibility","hidden"),d3$m.select(this).style("cursor","default")}))}return t.zoomable&&("versor"==t.zoomable?zoomversor(t):zoomandpan(t)),t.versor,t.selectAll("#geoviztooltip").raise(),Object.assign(t.node(),{metadata:"Map designed with https://github.com/neocarto/geoviz"}),t.node()}const d3$l=Object.assign({},{geoPath:geoPath,geoNaturalEarth1:geoNaturalEarth1});function outline(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({projection:d3$l.geoNaturalEarth1()}):t;let i={...{mark:"outline",id:unique$1(),fill:"#B5DFFD",stroke:"none",strokeWidth:1},...a?t:e};if("none"==r.initproj&&r.warning&&(r.warning_message.push("Outline mark"),r.warning_message.push("You must define a projection function in the SVG container")),"none"!=r.initproj){let t=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(t.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]={mark:i.mark,id:i.id}}else r.zoomablelayers.push({mark:i.mark,id:i.id});Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id"].includes(t))).forEach((e=>{t.attr(camelcasetodash$1(e),i[e])}));let e=d3$l.geoPath(r.projection);return t.append("path").attr("d",e({type:"Sphere"})),a?render(r):`#${i.id}`}}const d3$k=Object.assign({},{geoPath:geoPath,geoGraticule:geoGraticule,geoNaturalEarth1:geoNaturalEarth1});function graticule(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({projection:d3$k.geoNaturalEarth1()}):t;let i={...{mark:"graticule",id:unique$1(),step:10,fill:"none",stroke:"#9ad5e6",strokeWidth:.8,strokeLinecap:"square",strokeLinejoin:"round",strokeDasharray:2},...a?t:e};if("none"==r.initproj&&r.warning&&r.warning_message.push("You must define a projection function in the SVG container"),"none"!=r.initproj){let t=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(t.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]={mark:i.mark,id:i.id}}else r.zoomablelayers.push({mark:i.mark,id:i.id});Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","step"].includes(t))).forEach((e=>{t.attr(camelcasetodash$1(e),i[e])}));let e=d3$k.geoPath(r.projection);return t.append("path").datum(d3$k.geoGraticule().step(Array.isArray(i.step)?i.step:[i.step,i.step])).attr("d",e),a?render(r):`#${i.id}`}}const d3$j=Object.assign({},{geoPath:geoPath,geoIdentity:geoIdentity});function path(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create({zoomable:!0,control:!1,projection:"none",domain:t.data||t.datum}):t;let i={...{mark:"path",id:unique$1(),coords:"geo",clip:!0,strokeWidth:1},...a?t:e};(i.data||i.datum)&&(r.data=!0);const o=random();i.data&&(2==implantation(i.data)?(i.fill=i.fill?i.fill:"none",i.stroke=i.stroke?i.stroke:o):(i.fill=i.fill?i.fill:o,i.stroke=i.stroke?i.stroke:"white")),i.datum&&(2==implantation(i.datum)?(i.fill=i.fill?i.fill:"none",i.stroke=i.stroke?i.stroke:o):(i.fill=i.fill?i.fill:o,i.stroke=i.stroke?i.stroke:"none"));let n=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(n.selectAll("*").remove(),r.zoomable&&!r.parent)if(r.zoomablelayers.map((t=>t.id)).includes(i.id)){let t=r.zoomablelayers.indexOf(r.zoomablelayers.find((t=>t.id==i.id)));r.zoomablelayers[t]={mark:i.mark,id:i.id,coords:i.coords}}else r.zoomablelayers.push({mark:i.mark,id:i.id,coords:i.coords});let l="svg"==i.coords?d3$j.geoIdentity().scale(r.zoom.k).translate([r.zoom.x,r.zoom.y]):r.projection,s=d3$j.geoPath(l);const d=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id","datum","data","coords","tip","tipstyle"].includes(t)));let c=propertiesentries(i.data||i.datum);const p=d.filter((t=>"value"==detectinput(i[t],c)));p.forEach((t=>{n.attr(camelcasetodash$1(t),i[t])}));const h=d.filter((t=>!p.includes(t)));if(h.forEach((t=>{i[t]=check(i[t],c)})),1==i.clip&&"svg"!=i.coords&&"none"!==r.initproj){const t=unique$1();r.zoomable&&!r.parent&&r.zoomablelayers.push({mark:"outline",id:t}),r.append("clipPath").attr("id",t).append("path").attr("d",s({type:"Sphere"})),n.attr("clip-path",`url(#${t})`)}if(i.datum&&n.append("path").datum(i.datum).attr("d",s),i.data&&(n.selectAll("path").data(i.data.features.filter((t=>null!==t.geometry))).join((t=>{let e=t.append("path").attr("d",s);return h.forEach((t=>{e.attr(camelcasetodash$1(t),i[t])})),e})),i.tip&&tooltip(n,i.data,r,i.tip,i.tipstyle,c)),r=Object.assign(r,{viewbox:getsize$1(n)}),a){const t=getsize$1(n);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function header(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i={...{mark:"header",id:unique$1(),text:"Map title",fill:"#9e9696",background_fill:"white",background_stroke:"white",background_strokeWidth:1,dominantBaseline:"central",textAnchor:"middle",lineSpacing:0,margin:8,fontSize:26,dx:0,dy:0,fontFamily:r.fontFamily},...a?t:e},o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove();const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id"].includes(t))),l=o.append("text").attr("font-family",i.fontFamily).attr("font-size",i.fontSize).text(i.text.toString()),s=getsize$1(o).height,d=i.text.split("\n").length,c=s*d+(d-1)*i.lineSpacing+2*i.margin;l.remove(),r.height_header=Math.max(r.height_header,c);const p=o.append("rect").attr("x",0).attr("y",-c).attr("width",r.width).attr("height",c);n.filter((t=>t.includes("background_"))).forEach((t=>{p.attr(camelcasetodash$1(t.replace("background_","")),i[t])}));let h=r.width/2;switch(i.textAnchor){case"start":h=i.margin;break;case"end":h=r.width-i.margin}const u=o.selectAll("text").data(i.text.split("\n")).join("text").attr("x",h).attr("y",((t,e)=>e*(s+i.lineSpacing)-c+s/2+i.margin)).attr("dy",i.dy).text((t=>t));return n.filter((t=>!t.includes("background_"))).forEach((t=>{u.attr(camelcasetodash$1(t),i[t])})),r.attr("width",r.width).attr("height",r.height+r.height_header+r.height_footer).attr("viewBox",[0,-r.height_header,r.width,r.height+r.height_header+r.height_footer]),a?(r.attr("width",r.width).attr("height",c).attr("viewBox",[0,-c,r.width,c]),render(r)):`#${i.id}`}function footer(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i={...{mark:"footer",id:unique$1(),text:"Author, source...",fill:"#9e9696",background_fill:"white",background_stroke:"white",background_strokeWidth:1,dominantBaseline:"central",textAnchor:"middle",lineSpacing:0,margin:2,fontSize:10,dx:0,dy:0,fontFamily:r.fontFamily},...a?t:e},o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove();const n=Object.entries(i).map((t=>t[0])).filter((t=>!["mark","id"].includes(t))),l=o.append("text").attr("font-family",i.fontFamily).attr("font-size",i.fontSize).text(i.text.toString()),s=getsize$1(l).height,d=i.text.split("\n").length,c=s*d+(d-1)*i.lineSpacing+2*i.margin;l.remove(),r.height_footer=Math.max(r.height_footer,c);const p=o.append("rect").attr("x",0).attr("y",r.height).attr("width",r.width).attr("height",c);n.filter((t=>t.includes("background_"))).forEach((t=>{p.attr(camelcasetodash$1(t.replace("background_","")),i[t])}));let h=r.width/2;switch(i.textAnchor){case"start":h=i.margin;break;case"end":h=r.width-i.margin}const u=o.selectAll("text").data(i.text.split("\n")).join("text").attr("x",h).attr("y",((t,e)=>r.height+i.margin+e*(s+i.lineSpacing)+s/2)).attr("dy",i.dy).text((t=>t));return n.filter((t=>!t.includes("background_"))).forEach((t=>{u.attr(camelcasetodash$1(t),i[t])})),r.attr("width",r.width).attr("height",r.height+r.height_header+r.height_footer).attr("viewBox",[0,-r.height_header,r.width,r.height+r.height_header+r.height_footer]),a?(r.attr("width",r.width).attr("height",c).attr("viewBox",[0,r.height,r.width,c]),render(r)):`#${i.id}`}const d3$i=Object.assign({},{geoPath:geoPath});function clipPath(t,{id:e=unique$1(),datum:a={type:"Sphere"},permanent:r=!1}={}){let i=t.append("g");if(t.zoomable&&!t.parent&&0==r)if(t.zoomablelayers.map((t=>t.id)).includes(e)){let a=t.zoomablelayers.indexOf(t.zoomablelayers.find((t=>t.id==e)));t.zoomablelayers[a]={mark:"clippath",id:e}}else t.zoomablelayers.push({mark:"clippath",id:e});return i.append("clipPath").attr("id",e).append("path").datum(a).attr("d",d3$i.geoPath(t.projection)),`url(#${e})`}function blur(t,{id:e=unique$1(),stdDeviation:a=1.5}={}){let r=t.select("#defs");return r.select(`#${e}`).remove(),r.append("defs").append("filter").attr("id",e).append("feGaussianBlur").attr("stdDeviation",a),`url(#${e})`}function shadow(t,{id:e=unique$1(),stdDeviation:a=1.5,dx:r=4,dy:i=4,fill:o="black",fillOpacity:n=.5,opacity:l}={}){let s=t.select("#defs");return s.select(`#${e}`).remove(),s.append("defs").append("filter").attr("id",e).append("feDropShadow").attr("dx",r).attr("dy",i).attr("stdDeviation",a).attr("flood-color",o).attr("flood-opacity",l||n).append("feGaussianBlur"),`url(#${e})`}function radialGradient(t,{id:e=unique$1(),color1:a="#63b0af",color2:r="#428c8b",offset1:i=50,offset2:o=100,fx:n=50,fy:l=50}={}){let s=t.select("#defs");s.select(`#${e}`).remove();let d=s.append("radialGradient").attr("id",e).attr("fx",`${n}%`).attr("fy",`${l}%`);return d.append("stop").attr("offset",`${i}%`).attr("stop-color",a),d.append("stop").attr("offset",`${o}%`).attr("stop-color",r),`url(#${e})`}function camelcasetodash(t,e=""){return t.split(/(?=[A-Z])/).map((t=>t.toLowerCase())).join("-").replace(e+"_","")}function isNumber(t){return null!==t&&""!==t&&"boolean"!=typeof t&&isFinite(t)}function roundarray(t,e){return[floor(t[0],e),t.slice(1,-1).map((t=>round(t,e))),ceil(t[t.length-1],e)].flat()}function round(t,e){const a=Math.pow(10,e),r=t*a*(1+Number.EPSILON);return Math.round(r)/a}function floor(t,e){const a=Math.pow(10,e),r=t*a*(1+Math.sign(t)*Number.EPSILON);return Math.floor(r)/a}function ceil(t,e){const a=Math.pow(10,e),r=t*a*(1-Math.sign(t)*Number.EPSILON);return Math.ceil(r)/a}const d3$h=Object.assign({},{min:min,max:max,scaleSqrt:scaleSqrt,ascending:ascending});function datatoradius(t,{nb:e=4,k:a=50,round:r=2,fixmax:i=null}={}){let o=t.filter((t=>isNumber(t))).map((t=>Math.abs(t))).sort(d3$h.ascending);const n=null!=i?i:d3$h.max(o);let l=d3$h.scaleSqrt([0,n],[0,a]),s=[];if(o.length!=e&&null!=e){let t=l(d3$h.min(o)),a=l(d3$h.max(o)),r=a-t;if(e>2)for(let a=1;a<=e-2;a++)s.push(t+a*r/(e-1));s=[t,s,a].flat()}else s=o.map((t=>l(t)));let d=s.map((t=>l.invert(t)));return d[0]=d3$h.min(o),d[d.length-1]=d3$h.max(o),d=roundarray(d,r),d.map(((t,e)=>[t,s[e]]))}const d3$g=Object.assign({},{create:create$1});function getsize(t){const e=t.clone(!0),a=d3$g.create("svg");a.node().appendChild(e.node()),document.body.appendChild(a.node());const{x:r,y:i,width:o,height:n}=e.node().getBBox();return document.body.removeChild(a.node()),{x:r,y:i,width:o,height:n}}function mergeoptions(t,e){return Object.keys(t).forEach((a=>{void 0!==e[a]&&(t[a]=e[a])})),Object.keys(e).forEach((a=>{t[a]=e[a]})),t}function unique(){let t="";const e="abcdefghijklmnopqrstuvwxyz";for(let a=0;a<15;a++)t+=e.charAt(Math.floor(26*Math.random()));return t}function manageoptions(t,e,a){return{...{mark:"legend",id:unique(),pos:[0,0],gap:2,title:"Legend",title_fill:"#363636",title_fontSize:16,title_fontWeight:"bold",title_fontFamily:a,subtitle_fill:"#363636",subtitle_fontSize:12,subtitle_fontFamily:a,note_fill:"#363636",note_fontSize:10,note_fontStyle:"italic",note_fontFamily:a,values_fill:"#363636",values_fontSize:10,values_fontFamily:a,values_round:2,values_decimal:".",values_thousands:" ",values_dx:5,values_dy:0,values_dominantBaseline:"central",top_values_fill:"#363636",top_values_fontSize:10,top_values_fontFamily:a,top_values_round:2,top_values_decimal:".",top_values_thousands:" ",top_values_dx:5,top_values_dy:0,top_values_dominantBaseline:"central",top_title_fill:"#363636",top_title_fontSize:12,top_title_fontFamily:a,top_title_textAnchor:"middle",top_title_dominantBaseline:"hanging",bottom_title_fill:"#363636",bottom_title_fontSize:12,bottom_title_fontFamily:a,bottom_title_textAnchor:"middle",bottom_title_dominantBaseline:"hanging",bottom_values_fill:"#363636",bottom_values_fontSize:10,bottom_values_fontFamily:a,bottom_values_round:2,bottom_values_decimal:".",bottom_values_thousands:" ",bottom_values_dx:5,bottom_values_dy:0,bottom_values_dominantBaseline:"central",label_fill:"#363636",label_fontSize:10,label_dx:5,label_dominantBaseline:"central",label_fontFamily:a,rect_width:25,rect_height:17,rect_dx:0,rect_dy:0,rect_stroke:"#303030",rect_strokeWidth:.1,rect_spacing:0,spike_width:10,spike_dx:0,spike_dy:0,spike_spacing:3,spike_fill:"none",spike_stroke:"black",line_fill:"none",line_stroke:"#363636",line_strokeDasharray:2,line_strokeWidth:.7,line_length:10,circle_dx:0,circle_dy:0,circle_fill:"none",circle_stroke:"#363636",circle_spacing:5,top_circle_dx:0,top_circle_dy:0,top_circle_fill:"none",top_circle_stroke:"#363636",top_circle_spacing:5,bottom_circle_dx:0,bottom_circle_dy:0,bottom_circle_fill:"none",bottom_circle_stroke:"#363636",bottom_circle_spacing:5,missing:!0,missing_fill:"white",missing_text:"no data",frame:!1,frame_fill:"white",frame_fillOpacity:.5,frame_margin:15,frame_stroke:"black"},...t,...e}}function addTitle(t,e){if(e.title){const a=Object.assign(subsetobj(e,{prefix:"title_"}),subsetobj(e,{prefix:"text_"}));a.text=e.title,a.pos=e.pos,addText(t,a)}}function addSubtitle(t,e){if(e.subtitle){const a=getsize(t),r=Object.assign(subsetobj(e,{prefix:"subtitle_"}),subsetobj(e,{prefix:"text_"}));r.text=e.subtitle,r.pos=[e.pos[0],0==a.height?e.pos[1]:a.y+a.height+e.gap],addText(t,r)}}function addNote(t,e){if(e.note){const a=getsize(t),r=Object.assign(subsetobj(e,{prefix:"note_"}),subsetobj(e,{prefix:"text_"}));r.text=e.note,r.dy=void 0!==r.dy?r.dy:5,r.pos=[e.pos[0],0==a.height?e.pos[1]:a.y+a.height+e.gap],addText(t,r)}}function addFrame(t,e){if(e.frame){const a=subsetobj(e,{prefix:"frame_"}),r=getsize(t),i=t.append("rect").attr("x",r.x-a.margin).attr("y",r.y-a.margin).attr("width",r.width+2*a.margin).attr("height",r.height+2*a.margin).lower();Object.entries(a).forEach((t=>i.attr(camelcasetodash(t[0]),t[1])))}}function addText(t,e){e=mergeoptions({dx:0,dy:0,dominantBaseline:"hanging",textAnchor:"start",lineSpacing:0,fontSize:10},e);let a=t.append("g");Object.entries(e).forEach((t=>a.attr(camelcasetodash(t[0]),t[1])));let r={...e.pos};if(r[0]=r[0]+e.dx,r[1]=r[1]+e.dy,1==e.text.split("\n").length)a.append("text").attr("x",r[0]).attr("y",r[1]).text(e.text);else{let t=0;switch(e.dominantBaseline){case"hanging":default:t=0;break;case"middle":case"central":t=(e.text.split("\n").length-1)*e.fontSize,t/=2;break;case"auto":case"text-top":t=(e.text.split("\n").length-1)*e.fontSize}a.selectAll("text").data(e.text.split("\n")).join("text").attr("x",r[0]).attr("y",((a,i)=>r[1]+i*(e.fontSize+e.lineSpacing)-t)).text((t=>t))}}function subsetobj(t,{prefix:e,exclude:a=null}={}){let r={};return Object.entries(t).map((t=>t[0])).filter((t=>t.includes(e))).filter((t=>!t.includes(a))).forEach((a=>Object.assign(r,{[a.replace(e,"")]:t[a]}))),r}const d3$f=Object.assign({},{formatLocale:formatLocale});function circles_nested(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=datatoradius(i.data,{nb:i.nb,round:i.values_round,fixmax:i.fixmax,k:i.k}),l=n[n.length-1][1],s=o.append("g"),d=getsize(o),c=s.selectAll("circle").data(n.reverse()).join("circle").attr("r",(t=>t[1])).attr("transform",(t=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+d.height+2*l-t[1]})`)),p=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(p).forEach((t=>c.attr(camelcasetodash(t[0]),t[1])));let h=s.selectAll("line").data(n).join("line").attr("x1",i.pos[0]+l+i.circle_dx).attr("x2",i.pos[0]+l+l+i.line_length+i.circle_dx).attr("y1",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+2*l-2*t[1])).attr("y2",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+2*l-2*t[1])),u=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(u).forEach((t=>h.attr(camelcasetodash(t[0]),t[1])));let g=d3$f.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),m=s.selectAll("text").data(n).join("text").attr("x",i.pos[0]+l+l+i.line_length+i.circle_dx+i.values_dx).attr("y",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+2*l-2*t[1])).text((t=>g.format(",")(t[0]))),f=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(f).forEach((t=>m.attr(camelcasetodash(t[0]),t[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$e=Object.assign({},{formatLocale:formatLocale,sum:sum,cumsum:cumsum});function circles(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t,i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=datatoradius(i.data,{nb:i.nb,round:i.values_round,fixmax:i.fixmax,k:i.k}).slice().reverse(),l=n[0][1],s=d3$e.cumsum(n.map((t=>2*t[1]))),d=o.append("g"),c=getsize(o),p=d.selectAll("circle").data(n).join("circle").attr("r",(t=>t[1])).attr("transform",((t,e)=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+c.height+i.circle_dy+i.gap-t[1]+s[e]+e*i.circle_spacing} )`)),h=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(h).forEach((t=>p.attr(camelcasetodash(t[0]),t[1])));let u=d.selectAll("line").data(n).join("line").attr("x1",(t=>i.pos[0]+l+t[1]+i.circle_dx)).attr("x2",i.pos[0]+2*l+i.line_length+i.circle_dx).attr("y1",((t,e)=>i.pos[1]+c.height+i.circle_dy+i.gap-t[1]+s[e]+e*i.circle_spacing)).attr("y2",((t,e)=>i.pos[1]+c.height+i.circle_dy+i.gap-t[1]+s[e]+e*i.circle_spacing)),g=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(g).forEach((t=>u.attr(camelcasetodash(t[0]),t[1])));let m=d3$e.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),f=d.selectAll("text").data(n).join("text").attr("x",i.pos[0]+2*l+i.line_length+i.values_dx+i.circle_dx).attr("y",((t,e)=>i.pos[1]+c.height+i.circle_dy+i.gap-t[1]+s[e]+e*i.circle_spacing)).text((t=>m.format(",")(t[0]))),y=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(y).forEach((t=>f.attr(camelcasetodash(t[0]),t[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$d=Object.assign({},{formatLocale:formatLocale,arc:arc});function circles_half(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({data:[30,1e3],k:50,fixmax:null,nb:4,circle_cornerRadius:5,values_dx:2,values_dominantBaseline:"middle"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=datatoradius(i.data,{nb:i.nb,round:i.values_round,fixmax:i.fixmax,k:i.k}),l=n[n.length-1][1],s=o.append("g"),d=getsize(o),c=s.selectAll("path").data(n.reverse()).join("path").attr("d",(t=>d3$d.arc().outerRadius(t[1]).innerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.circle_cornerRadius)())).attr("transform",(t=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+d.height+l+i.values_fontSize/2})`)),p=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(p).forEach((t=>c.attr(camelcasetodash(t[0]),t[1])));let h=s.selectAll("line").data(n).join("line").attr("x1",i.pos[0]+l+i.circle_dx).attr("x2",i.pos[0]+l+l+i.line_length+i.circle_dx).attr("y1",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+l-t[1]+i.values_fontSize/2)).attr("y2",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+l-t[1]+i.values_fontSize/2)),u=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(u).forEach((t=>h.attr(camelcasetodash(t[0]),t[1])));let g=d3$d.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),m=s.selectAll("text").data(n).join("text").attr("x",i.pos[0]+l+l+i.line_length+i.circle_dx+i.values_dx).attr("y",(t=>i.pos[1]+i.circle_dy+i.gap+d.height+l-t[1]+i.values_fontSize/2)).text((t=>g.format(",")(t[0]))),f=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(f).forEach((t=>m.attr(camelcasetodash(t[0]),t[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$c=Object.assign({},{min:min,max:max,ascending:ascending,scaleLinear:scaleLinear});function datatoheight(t,{nb:e=4,k:a=50,round:r=2,fixmax:i=null}={}){let o=t.filter((t=>isNumber(t))).map((t=>Math.abs(t))).sort(d3$c.ascending);const n=null!=i?i:d3$c.max(o);let l=d3$c.scaleLinear().domain([0,n]).range([0,a]),s=[];if(o.length!=e&&null!=e){let t=l(d3$c.min(o)),a=l(d3$c.max(o)),r=a-t;if(e>2)for(let a=1;a<=e-2;a++)s.push(t+a*r/(e-1));s=[t,s,a].flat()}else s=o.map((t=>l(t)));let d=s.map((t=>l.invert(t)));return d[0]=d3$c.min(o),d[d.length-1]=d3$c.max(o),d=roundarray(d,r),d.map(((t,e)=>[t,s[e]]))}const d3$b=Object.assign({},{formatLocale:formatLocale,sum:sum,cumsum:cumsum});function spikes(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,spike_width:30,spike_straight:0,values_dx:0,values_dy:0,values_dominantBaseline:"middle"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=datatoheight(i.data,{nb:i.nb,round:i.values_round,fixmax:i.fixmax,k:i.k}).slice().reverse(),l=n[0][1],s=o.append("g"),d=getsize(o),c=s.selectAll("path").data(n).join("path").attr("d",(t=>`m ${0-i.spike_width/2},0 Q 0,${0-t[1]*i.spike_straight},0 ${0-t[1]}\n   Q 0, ${0-t[1]*i.spike_straight} ${0+i.spike_width/2},0`)).attr("transform",((t,e)=>`translate(${i.spike_width/2+i.pos[0]+i.spike_dx+ +i.spike_width*e+e*i.spike_spacing},${i.pos[1]+d.height+i.spike_dy+l+i.gap})`)),p=subsetobj(i,{prefix:"spike_",exclude:["dx","dy"]});Object.entries(p).forEach((t=>c.attr(camelcasetodash(t[0]),t[1]))),d=getsize(o);let h=d3$b.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),u=s.selectAll("text").data(n).join("text").text((t=>h.format(",")(t[0]))).attr("transform",((t,e)=>`translate (${i.pos[0]+i.spike_dx+i.spike_width/2+i.spike_width*e+e*i.spike_spacing} ${i.pos[1]+d.height+i.spike_dy}) rotate(90)`)),g=subsetobj(i,{prefix:"values_"});if(Object.entries(g).forEach((t=>u.attr(camelcasetodash(t[0]),t[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$a=Object.assign({},{formatLocale:formatLocale,arc:arc});function mushrooms(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({top_data:[30,1e3],top_k:50,top_title:"top_title",top_fixmax:null,top_nb:4,top_circle_cornerRadius:5,top_values_dx:2,top_values_dominantBaseline:"middle",top_values_textAnchor:"start",bottom_data:[30,1e3],bottom_k:50,bottom_title:"bottom_title",bottom_fixmax:null,bottom_nb:4,bottom_circle_cornerRadius:5,bottom_values_dx:2,bottom_values_dominantBaseline:"middle",bottom_values_textAnchor:"start"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=datatoradius(i.top_data,{nb:i.top_nb,round:i.top_values_round,fixmax:i.top_fixmax,k:i.top_k}),l=datatoradius(i.bottom_data,{nb:i.bottom_nb,round:i.bottom_values_round,fixmax:i.bottom_fixmax,k:i.bottom_k}),s=n[n.length-1][1],d=l[l.length-1][1],c=Math.max(s,d),p=o.append("g"),h=getsize(o),u=p.selectAll("path").data(n.reverse()).join("path").attr("d",(t=>d3$a.arc().outerRadius(t[1]).innerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.top_circle_cornerRadius)())).attr("transform",(t=>`translate(${i.pos[0]+c+i.top_circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+i.top_values_fontSize/2+h.height+s})`)),g=subsetobj(i,{prefix:"top_circle_",exclude:["dx","dy"]});Object.entries(g).forEach((t=>u.attr(camelcasetodash(t[0]),t[1])));let m=p.selectAll("line").data(n).join("line").attr("x1",i.pos[0]+c+i.top_circle_dx).attr("x2",i.pos[0]+c+c+i.line_length+i.top_circle_dx).attr("y1",(t=>i.pos[1]+i.top_circle_dy+i.gap+h.height+s-t[1]+i.top_values_fontSize/2)).attr("y2",(t=>i.pos[1]+i.top_circle_dy+i.gap+h.height+s-t[1]+i.top_values_fontSize/2)),f=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(f).forEach((t=>m.attr(camelcasetodash(t[0]),t[1])));let y=d3$a.formatLocale({decimal:i.top_values_decimal,thousands:i.top_values_thousands,grouping:[3]}),x=p.selectAll("text").data(n).join("text").attr("x",i.pos[0]+c+c+i.line_length+i.top_circle_dx+i.top_values_dx).attr("y",(t=>i.pos[1]+i.top_circle_dy+i.gap+h.height+s-t[1]+i.top_values_fontSize/2)).text((t=>y.format(",")(t[0]))),b=subsetobj(i,{prefix:"top_values_",exclude:["dx","dy"]});Object.entries(b).forEach((t=>x.attr(camelcasetodash(t[0]),t[1]))),h=getsize(o);let _=p.append("text").attr("x",i.pos[0]+c).attr("y",i.pos[1]+h.height+i.gap).text(i.top_title),$=subsetobj(i,{prefix:"top_title_",exclude:["dx","dy"]});Object.entries($).forEach((t=>_.attr(camelcasetodash(t[0]),t[1]))),h=getsize(o);let v=p.append("text").attr("x",i.pos[0]+c).attr("y",i.pos[1]+h.height+i.gap).text(i.bottom_title),k=subsetobj(i,{prefix:"bottom_title_",exclude:["dx","dy"]});Object.entries(k).forEach((t=>v.attr(camelcasetodash(t[0]),t[1])));const w=o.append("g");h=getsize(o);let j=w.selectAll("path").data(l.reverse()).join("path").attr("d",(t=>d3$a.arc().outerRadius(t[1]).innerRadius(0).startAngle(.5*Math.PI).endAngle(1.5*Math.PI).cornerRadius(i.bottom_circle_cornerRadius)())).attr("transform",(t=>`translate(${i.pos[0]+c+i.bottom_circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+h.height})`)),z=subsetobj(i,{prefix:"bottom_circle_",exclude:["dx","dy"]});Object.entries(z).forEach((t=>j.attr(camelcasetodash(t[0]),t[1])));let A=w.selectAll("line").data(l).join("line").attr("x1",i.pos[0]+c+i.bottom_circle_dx).attr("x2",i.pos[0]+c+c+i.line_length+i.bottom_circle_dx).attr("y1",(t=>i.pos[1]+i.bottom_circle_dy+i.gap+h.height+t[1])).attr("y2",(t=>i.pos[1]+i.bottom_circle_dy+i.gap+h.height+t[1]));Object.entries(f).forEach((t=>A.attr(camelcasetodash(t[0]),t[1])));let O=d3$a.formatLocale({decimal:i.bottom_values_decimal,thousands:i.bottom_values_thousands,grouping:[3]}),S=w.selectAll("text").data(l).join("text").attr("x",i.pos[0]+c+c+i.line_length+i.bottom_circle_dx+i.bottom_values_dx).attr("y",(t=>i.pos[1]+i.bottom_circle_dy+i.gap+h.height+t[1])).text((t=>O.format(",")(t[0]))),E=subsetobj(i,{prefix:"bottom_values_",exclude:["dx","dy"]});if(Object.entries(E).forEach((t=>S.attr(camelcasetodash(t[0]),t[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$9=Object.assign({},{formatLocale:formatLocale});function choro_vertical(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({breaks:[1,2,3,4,5],colors:["#fee5d9","#fcae91","#fb6a4a","#cb181d"]},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=d3$9.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),l=o.append("g"),s=getsize(o);const d=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));Object.entries(d).forEach((t=>l.attr(camelcasetodash(t[0]),t[1]))),l.selectAll("text").data(i.reverse?roundarray(i.breaks,i.values_round):roundarray(i.breaks.slice().reverse(),i.values_round)).join("text").attr("x",i.pos[0]+i.rect_width+i.values_dx).attr("y",((t,e)=>i.pos[1]+i.values_fontSize/2+s.height+i.gap+i.values_dy+e*(i.rect_height+i.rect_spacing))).text((t=>n.format(",")(t)));let c=o.append("g"),p=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(p).forEach((t=>c.attr(camelcasetodash(t[0]),t[1])));let h=i.pos[1]+s.height+i.gap+i.rect_dy,u=i.pos[0]+i.rect_dx;if(c.selectAll("rect").data(i.reverse?i.colors:i.colors.slice().reverse()).join("rect").attr("x",u).attr("y",((t,e)=>h+i.rect_spacing/2+i.values_fontSize/2+e*(i.rect_height+i.rect_spacing))).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill",(t=>t)),i.missing){let t=o.append("g"),e=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=e.y+e.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=t.append("rect");Object.entries(a).forEach((t=>r.attr(camelcasetodash(t[0]),t[1]))),d.text=i.missing_text,d.pos=[i.pos[0]+i.rect_width,e.y+e.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(t,d)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$8=Object.assign({},{formatLocale:formatLocale});function choro_horizontal(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({title:"Legend",breaks:[1,2,3,4,5],colors:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],values_textAnchor:"middle",values_dx:0,values_dy:5,rect_width:50,rect_height:14},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let n=d3$8.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),l=o.append("g"),s=getsize(o);const d=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));Object.entries(d).forEach((t=>l.attr(camelcasetodash(t[0]),t[1])));let c=o.append("g"),p=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(p).forEach((t=>c.attr(camelcasetodash(t[0]),t[1])));let h=i.pos[1]+s.height+i.gap+i.rect_dy,u=i.pos[0]+i.rect_dx;if(c.selectAll("rect").data(i.reverse?i.colors.slice().reverse():i.colors).join("rect").attr("x",((t,e)=>u+e*(i.rect_spacing+i.rect_width))).attr("y",h).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill","red").attr("fill",(t=>t)),s=getsize(o),l.selectAll("text").data(i.reverse?roundarray(i.breaks.slice().reverse(),i.values_round):roundarray(i.breaks,i.values_round)).join("text").attr("x",((t,e)=>i.pos[0]+e*(i.rect_width+i.rect_spacing)+i.values_dx)).attr("y",i.pos[1]+s.height+i.gap+i.values_dy).text((t=>n.format(",")(t))),i.missing){let t=o.append("g"),e=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=e.y+e.height+i.gap+a.dy+i.gap;let r=t.append("rect");Object.entries(a).forEach((t=>r.attr(camelcasetodash(t[0]),t[1]))),d.text=i.missing_text,d.dx=5,d.dy=0,d.textAnchor="start",d.pos=[i.pos[0]+i.rect_width,e.y+e.height+i.gap+a.dy+a.height/2+i.gap],addText(t,d)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function typo_vertical(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({types:["A","B","C","D"],colors:["#e41a1c","#377eb8","#4daf4a","#984ea3"],alphabetical:!0,rect_spacing:3},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i),i.alphabetical){let t=i.types.map(((t,e)=>[t,i.colors[e]])).sort();i.types=t.map((t=>t[0])),i.colors=t.map((t=>t[1]))}let n=getsize(o),l=o.append("g"),s=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(s).forEach((t=>l.attr(camelcasetodash(t[0]),t[1])));let d=i.pos[1]+n.height+i.gap+i.rect_dy,c=i.pos[0]+i.rect_dx;l.selectAll("rect").data(i.colors).join("rect").attr("x",c).attr("y",((t,e)=>d+i.rect_spacing/2+e*(i.rect_height+i.rect_spacing))).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill",(t=>t));let p=o.append("g");const h=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));if(Object.entries(h).forEach((t=>p.attr(camelcasetodash(t[0]),t[1]))),p.selectAll("text").data(i.types).join("text").attr("x",c+i.rect_width+i.values_dx).attr("y",((t,e)=>d+i.rect_spacing/2+e*(i.rect_height+i.rect_spacing)+i.rect_height/2)).text((t=>t)),i.missing){let t=o.append("g"),e=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=e.y+e.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=t.append("rect");Object.entries(a).forEach((t=>r.attr(camelcasetodash(t[0]),t[1]))),h.text=i.missing_text,h.pos=[i.pos[0]+i.rect_width,e.y+e.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(t,h)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function typo_horizontal(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({types:["A","B","C","D"],colors:["#e41a1c","#377eb8","#4daf4a","#984ea3"],alphabetical:!0,values_dx:0,values_dy:5,values_textAnchor:"middle",rect_spacing:3,rect_width:50,rect_height:14},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i),i.alphabetical){let t=i.types.map(((t,e)=>[t,i.colors[e]])).sort();i.types=t.map((t=>t[0])),i.colors=t.map((t=>t[1]))}let n=getsize(o),l=o.append("g"),s=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(s).forEach((t=>l.attr(camelcasetodash(t[0]),t[1])));let d=i.pos[1]+n.height+i.gap+i.rect_dy,c=i.pos[0]+i.rect_dx;l.selectAll("rect").data(i.colors).join("rect").attr("x",((t,e)=>c+e*(i.rect_spacing+i.rect_width))).attr("y",d).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill","red").attr("fill",(t=>t));let p=o.append("g");const h=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));if(Object.entries(h).forEach((t=>p.attr(camelcasetodash(t[0]),t[1]))),n=getsize(o),p.selectAll("text").data(i.types).join("text").attr("x",((t,e)=>c+e*(i.rect_spacing+i.rect_width)+i.rect_width/2)).attr("y",i.pos[1]+n.height+i.gap+i.values_dy).text((t=>t)),i.missing){let t=o.append("g"),e=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=e.y+e.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=t.append("rect");Object.entries(a).forEach((t=>r.attr(camelcasetodash(t[0]),t[1]))),h.text=i.missing_text,h.dx=5,h.dy=0,h.textAnchor="start",h.pos=[i.pos[0]+i.rect_width,e.y+e.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(t,h)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}function box(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?create():t;let i=manageoptions({title:void 0,label:"label",rect_fill:"#5d6266"},a?t:e,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),i=subsetobj(i,{prefix:"",exclude:["id","mark"]}),addTitle(o,i),addSubtitle(o,i);let n=getsize(o),l=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});l.x=i.pos[0]+l.dx,l.y=0==n.height?i.pos[1]+l.dy:n.y+n.height+i.gap+l.dy;let s=o.append("rect");Object.entries(l).forEach((t=>s.attr(camelcasetodash(t[0]),t[1]))),n=getsize(o);const d=Object.assign(subsetobj(i,{prefix:"label_"}),subsetobj(i,{prefix:"text_"}));if(d.text=i.label,d.pos=[i.pos[0]+l.width,i.pos[1]+n.height-l.height/2],addText(o,d),addNote(o,i),i.frame&&addFrame(o,i),a){const t=getsize(o);return r.attr("width",t.width).attr("height",t.height).attr("viewBox",[t.x,t.y,t.width,t.height]),render(r)}return`#${i.id}`}const d3$7=Object.assign({},{create2:create$1,geoPath:geoPath,geoBounds:geoBounds,geoEquirectangular:geoEquirectangular,geoMercator:geoMercator,geoIdentity:geoIdentity});function create({height:t=null,projection:e="none",domain:a,pos:r=[0,0],background:i="none",width:o=1e3,margin:n=[0,0,0,0],parent:l=null,fontFamily:s="Arial",zoomable:d=!1,control:c=!0,warning:p=!0,warning_message:h=[]}={}){const u=e;switch(e){case"mercator":e=d3$7.geoMercator();break;case"none":e=d3$7.geoIdentity().reflectY(!0)}let g,m;if(null!==t)m={width:o,height:t,fontFamily:s};else{let r=extent(a,u);n=Array.isArray(n)?n:Array(4).fill(n);const[[i,g],[f,y]]=d3$7.geoPath(e.fitWidth(o-n[1]-n[3],r)).bounds(r);t=Math.ceil(y-g)+n[0]+n[2];let x=e.translate();e.translate([x[0]+n[3],x[1]+n[0]]),e.clipExtent([[0,0],[o,t]]),m={initproj:u,domain:a,projection:e,baseScale:e.scale(),baseTranslate:e.translate(),margin:n,width:o,height:t,viewbox:[],height_header:0,height_footer:0,fontFamily:s,zoomable:d,control:c,controlid:"control_"+unique$1(),zoomablelayers:[],zoom:{k:1,x:0,y:0},bbox:d3$7.geoBounds(r),inset:!!l,warning:p,warning_message:h,data:!1}}if(null==l){let e=d3$7.create2("svg").attr("width",o).attr("height",t).attr("viewBox",[0,0,o,t]).style("background-color",i);e.append("defs").attr("id","defs"),e.append("g").attr("id","geoviztooltip"),g=Object.assign(e,m)}else{let e=l.append("g").attr("transform",`translate(${r[0]},${r[1]})`);e.append("defs").attr("id","defs"),e.append("rect").attr("x",0).attr("y",0).attr("width",o).attr("height",t).attr("fill",i),e.append("g").attr("id","geoviztooltip"),g=Object.assign(e,m)}let f={};[{id:"outline",func:outline},{id:"path",func:path},{id:"graticule",func:graticule},{id:"circle",func:circle},{id:"halfcircle",func:halfcircle},{id:"spike",func:spike},{id:"text",func:text},{id:"tile",func:tile},{id:"header",func:header},{id:"footer",func:footer},{id:"scalebar",func:scalebar},{id:"north",func:north}].forEach((t=>f[t.id]=function(){return t.func(g,arguments[0])}));let y={};[{id:"circles_nested",func:circles_nested},{id:"circles",func:circles},{id:"circles_half",func:circles_half},{id:"spikes",func:spikes},{id:"mushrooms",func:mushrooms},{id:"choro_vertical",func:choro_vertical},{id:"choro_horizontal",func:choro_horizontal},{id:"typo_vertical",func:typo_vertical},{id:"typo_horizontal",func:typo_horizontal},{id:"box",func:box}].forEach((t=>y[t.id]=function(){return t.func(g,arguments[0])}));let x={};return[{id:"blur",func:blur},{id:"shadow",func:shadow},{id:"radialGradient",func:radialGradient},{id:"clipPath",func:clipPath},,].forEach((t=>x[t.id]=function(){return t.func(g,arguments[0])})),Object.assign(g,{...f,legend:y,effect:x,render:function(){return render(g,arguments[0])}})}const d3$6=Object.assign({},{scaleLinear:scaleLinear,min:min,max:max,mean:mean,mode:mode});function ridge(t,{x:e="x",y:a="y",z:r="z",k:i=100,fixmax:o=null,projection:n=(t=>t)}={}){let l=getres(t,e);return toLineString(split(t,l,{x:e,y:a,z:r,fixmax:o}),l,{z:r,k:i,projection:n})}function toLineString(t,e,{x:a="x",y:r="y",z:i="z",k:o=100,fixmax:n=null,projection:l=(t=>t)}={}){const s=null!=n?n:d3$6.max(t.map((t=>t[0][i]))),d=d3$6.scaleLinear().domain([0,s]).range([0,o]);let c=[];return t.forEach(((t,o)=>{let n=t.map((t=>t[i])),s=d3$6.min(n),p=d3$6.max(n),h=d3$6.mean(n),u=t[0][a]-e<-180?-180:t[0][a]-e,g=t[t.length-1][a]+e>180?180:t[t.length-1][a]+e;t.unshift({[a]:u,[r]:t[0][r],[i]:0}),t.push({[a]:g,[r]:t[0][r],[i]:0}),c.push({type:"Feature",properties:{min:s,max:p,mean:h},geometry:{type:"LineString",coordinates:t.map((t=>[l([t[a],t[r]])[0],l([t[a],t[r]])[1]-d(t[i])]))}})})),{type:"FeatureCollection",features:c}}function split(t,e,{x:a="x",y:r="y",z:i="z"}={}){const o=Array.from(new Set(t.map((t=>t[r]))));let n=[];return o.forEach((i=>{let o=t.filter((t=>t[r]==i)),l=[],s=[];for(let t=0;t<o.length-1;t++)s.push(o[t]),(o[t+1][a]-o[t][a]>e+.1*e||t==o.length-2)&&(l.push(s),s=[]);return n.push(l)})),n.flat()}function getres(t,e){let a=[];for(let r=0;r<t.length-1;r++)a.push(t[r+1][e]-t[r][e]);return d3$6.mode(a)}const d3$5=Object.assign({},{geoArea:geoArea});function dissolve(t,e={areashare:"_share"}){t=JSON.parse(JSON.stringify(t));let a=[];t.features.forEach((t=>{a.push(sp(t,e.areashare))}));const r=Object.keys(t).filter((t=>"features"!=t)),i={};return r.forEach((e=>{i[e]=t[e]})),i.features=a.flat(),i}function sp(t,e){let a=[];t.geometry.type.includes("Multi")?t.geometry.coordinates.forEach((e=>{a.push({type:"Feature",properties:t.properties,geometry:{type:t.geometry.type.replace("Multi",""),coordinates:e}})})):a.push({...t});const r=d3$5.geoArea(t);return a.forEach((t=>t.properties={...t.properties,[e]:d3$5.geoArea(t)/r})),JSON.parse(JSON.stringify(a))}const d3$4=Object.assign({},{geoProject:geoProject});function project(t,{projection:e=null}={}){return null==e?t:d3$4.geoProject(t,e)}function unproject(t,e={}){let a=JSON.parse(JSON.stringify(t));return a.features.forEach((t=>t.geometry.coordinates=unprojectCoords(t.geometry.coordinates,e.projection))),a}function unprojectCoords(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return unprojectCoords(t,e)}))}const d3$3=Object.assign({},{sum:sum});function replicate(t,{field:e,targetvalue:a}={}){let r=JSON.parse(JSON.stringify(t));a=a||d3$3.sum(r.features.map((t=>parseFloat(t.properties[e]))))/2e3;let i=[];for(let t=0;t<=r.features.length-1;t++){let o=Math.round(+r.features[t].properties[e]/a);for(let e=1;e<=o;e++)i.push({...r.features[t]})}return r.features=i,r}function rewind(t,e={}){t=JSON.parse(JSON.stringify(t));let a=!1!==e.outer,r=!0===(!1!==e.mutate)?t:JSON.parse(JSON.stringify(x));for(let t=0;t<r.features.length;t++)if("Polygon"===r.features[t].geometry.type)rewindRings(r.features[t].geometry.coordinates,a);else if("MultiPolygon"===r.features[t].geometry.type)for(let e=0;e<r.features[t].geometry.coordinates.length;e++)rewindRings(r.features[t].geometry.coordinates[e],a);return r}function rewindRings(t,e){if(0!==t.length){rewindRing(t[0],e);for(let a=1;a<t.length;a++)rewindRing(t[a],!e)}}function rewindRing(t,e){let a=0,r=0;for(let e=0,i=t.length,o=i-1;e<i;o=e++){const i=(t[e][0]-t[o][0])*(t[o][1]+t[e][1]),n=a+i;r+=Math.abs(a)>=Math.abs(i)?a-n+i:i-n+a,a=n}a+r>=0!=!!e&&t.reverse()}function coords2geo(t,e={}){let a=e.lat||e.latitude,r=e.lon||e.lng||e.longitude,i=e.coords||e.coordinates;!e.sep&&!e.separator||(e.sep||e.separator);let o=!!e.reverse;if(a&&r){let e=o?r:a,i=o?a:r;return{type:"FeatureCollection",features:t.map((t=>({type:"Feature",properties:t,geometry:{type:"Point",coordinates:[+t[i],+t[e]]}})))}}return i?{type:"FeatureCollection",features:t.map((t=>({type:"Feature",properties:t,geometry:{type:"Point",coordinates:o?getcoords(t[i]):getcoords(t[i]).reverse()}})))}:i}function txt2coords(t,e=","){let a=(t=t.replace(/[ ]+/g,"")).split(e).map((t=>t.replace(",","."))).map((t=>t.replace(/[^\d.-]/g,""))).map((t=>+t));return 2!=a.length&&(a=[void 0,void 0]),a}function wkt2coords(t){let e=t.match(/\(([^)]+)\)/g);return null===e?[void 0,void 0]:e[0].replace(/\s\s+/g," ").replace("(","").replace(")","").trimStart().trimEnd().split(" ").map((t=>t.replace(",","."))).map((t=>+t))}function getcoords(t){return t?t.toLowerCase().includes("point")?wkt2coords(t):txt2coords(t):null}function featurecollection(t,e={}){let a=JSON.parse(JSON.stringify(t));if("table"==whatisit(a)&&1==checkTable(e))return coords2geo(a,e);if("table"==whatisit(a)&&1==checkGeoTable(e))return geotabletogeojson(a,e);switch(whatisit(a)){case"FeatureCollection":default:return a;case"features":return{type:"FeatureCollection",features:a};case"feature":return{type:"FeatureCollection",features:[a]};case"geometries":return{type:"FeatureCollection",features:a.map((t=>({type:"Feature",properties:{},geometry:t})))};case"geometry":return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:a}]};case"bbox":return bbox(a)}}function checkTable(t){return!!(t.lat&&t.lon||t.latitude&&t.longitude||t.coords||t.coordinates)}function checkGeoTable(t){return!(!t.geom&&!t.geometry)}function geotabletogeojson(t,{geometry:e="geometry"}={}){let a=JSON.parse(JSON.stringify(t)),r=a.map((t=>t[e]));return a.forEach((t=>delete t[e])),{type:"FeatureCollection",features:a.map(((t,e)=>({type:"Feature",properties:t,geometry:r[e]})))}}function merge({geom:t,geom_id:e,data:a,data_id:r,id:i}={}){i&&(e=i,r=i);let o=addUnderscore(a,(t=JSON.parse(JSON.stringify(t))).features.map((t=>t.properties)),r);a=o[0],r=o[1];let n=new Map(a.map((t=>[t[r],t]))),l=[];t.features.forEach((t=>{let a={};Object.keys(t).forEach((r=>{"properties"==r?Object.assign(a,{properties:Object.assign({...t.properties},{...n.get(t.properties[e])})}):Object.assign(a,{[r]:t[r]})})),l.push(a)}));let s={};Object.keys(t).forEach((e=>{s=Object.assign(s,{[e]:"features"==e?l:t[e]})}));let d=t.features.map((t=>t.properties[e])),c=a.map((t=>t[r])),p=d.length-new Set(d).size,h=c.length-new Set(c).size,u=d.filter((t=>c.includes(t))).filter((t=>c.includes(t))),g=d.filter((t=>!c.includes(t))),m=c.filter((t=>!d.includes(t)));return{featureCollection:s,diagnostic:{duplicate_data:h,duplicate_geom:p,geom:d,data:c,matched:u,unmatched_geom:g,unmatched_data:m}}}function addUnderscore(t,e,a){let r=columns(t),i=columns(e),o=[...r];for(;0!==o.filter((t=>i.includes(t))).length;)o.filter((t=>i.includes(t))).forEach((t=>{o[o.indexOf(t)]="_"+t}));let n=new Map(r.map(((t,e)=>[t,o[e]]))),l=[];return t.forEach((t=>{let e={};Object.keys(t).forEach((a=>{e[n.get(a)]=t[a]})),l.push(e)})),[l,n.get(a)]}function geotable(t,{geometry:e="geometry"}={}){return JSON.parse(JSON.stringify(t)).features.map((t=>Object.assign(t.properties,{[e]:t.geometry})))}const d3$2=Object.assign({},{geoProjection:geoProjection});function proj4d3(t,e){const a=180/Math.PI,r=1/a,i=t(e),o=function(t,e){return i.forward([t*a,e*a])};o.invert=function(t,e){return i.inverse([t,e]).map((function(t){return t*r}))};const n=d3$2.geoProjection(o).scale(1);return n.raw=i,n}function addfonts(t){return t.map((t=>{const e=new FontFace(t.fontFamily,`url(${t.url})`,{style:t.style,weight:t.weight,stretch:t.stretch});return e.load(),document.fonts.add(e),t}))}const d3$1=Object.assign({},{scaleThreshold:scaleThreshold,min:min,interpolateRgbBasis:interpolateRgbBasis,range:range});function choro(t,{method:e="quantile",breaks:a=null,colors:r="Algae",reverse:i=!1,nb:o=6,k:n=1,middle:l,precision:s=2,missing_fill:d="white"}={}){let c=t.filter((t=>isNumber(t)));const p=a||discr.breaks(c,{method:e,nb:o,k:n,middle:l,precision:s});let h=palette(r,p.length-1);i&&(h=[...h].reverse());const u=t.length-c.length;return{breaks:p,colors:h,missing:0!=u,missing_fill:d,nodata:u,colorize:function(t){return d3$1.scaleThreshold(p.slice(1,-1),h).unknown(d)(parseFloat(t))}}}function palette(t,e){let a;if("string"==typeof t&&(a=getColors(t,e),null==a)){const a=getPalettes({name:t}).map((t=>t.number)),r=d3$1.min(a.map((t=>Math.abs(t-e)))),i=a.findIndex((t=>Math.abs(t-e)==r)),o=getColors(t,a[i]);return d3$1.range(e).map((t=>d3$1.interpolateRgbBasis(o)(t/e)))}return"object"==typeof t&&(a=t.length!=e?d3$1.range(e).map((a=>d3$1.interpolateRgbBasis(t)(a/e))):t),a}const d3=Object.assign({},{scaleOrdinal:scaleOrdinal});function typo(t,{colors:e="Set3",missing_fill:a="white"}={}){let r=Array.from(new Set(t)).filter((t=>""!==t&&null!=t&&null!=t)),i=t.length-t.filter((t=>""!==t&&null!=t&&null!=t)).length,o=Array.isArray(e)?e:getColors(e,r.length);return{types:r,colors:o,missing:0!=i,missing_fill:a,nodata:i,colorize:d3.scaleOrdinal().domain(r).range(o).unknown(a)}}function bubble(t,e){let a=arguments.length<=1&&!arguments[0]?._groups;t=a&&null==t?{}:t,e=null==e?{}:e;let r=a?t:e,i={projection:"none",title:"title",leg_type:"nested",leg_pos:[10,10],id:unique$1(),var:10,leg_id:unique$1(),leg_type:"nested",leg_title:"leg_title",leg_subtitle:"leg_subtitle"};Object.keys(i).forEach((t=>{void 0!==r[t]&&(i[t]=r[t])})),Object.keys(r).forEach((t=>{i[t]=r[t]}));var o,n;o="var",n="r",delete Object.assign(i,{[n]:i[o]})[o];let l=a?create({zoomable:!0,domain:t.data||t.datum,projection:i.projection}):t;3==implantation(i.data)&&a&&l.path({datum:i.data,fill:"#CCC",fillOpacity:.2});let s={};Object.keys(i).filter((t=>"leg_"!=t.slice(0,4))).forEach((t=>Object.assign(s,{[t]:i[t]}))),l.circle(s);let d=getsize$1(l);l.attr("width",d.width).attr("height",d.height).attr("viewBox",[d.x,d.y,d.width,d.height]);let c,p={};return Object.keys(i).filter((t=>"leg_"==t.slice(0,4)||["k","fixmax"].includes(t))).forEach((t=>Object.assign(p,{["leg_"==t.slice(0,4)?t.slice(4):t]:i[t]}))),p.data=p.data?p.data:i.data.features.map((t=>t.properties[s.r])),c="nested"==i.leg_type?l.legend.circles_nested(p):l.legend.circles(p),l.select(c).attr("transform",`translate(${d.x} ${d.y})`),d=getsize$1(l),l.select(l.controlid).attr("transform",`translate(${d.x} ${d.y})`),a?(l.attr("width",d.width).attr("height",d.height).attr("viewBox",[d.x,d.y,d.width,d.height]),l.render()):[`#${s.id}`,`#${p.id}`]}let container={create:create,render:render},tool={addfonts:addfonts,rewind:rewind,featurecollection:featurecollection,merge:merge,geotable:geotable,proj4d3:proj4d3,dissolve:dissolve,centroid:centroid,project:project,unproject:unproject,dodge:dodge,replicate:replicate,ridge:ridge,choro:choro,typo:typo,random:random,radius:radius},legend={circles:circles,circles_nested:circles_nested,circles_half:circles_half,choro_vertical:choro_vertical,choro_horizontal:choro_horizontal,typo_vertical:typo_vertical,typo_horizontal:typo_horizontal,box:box,spikes:spikes,mushrooms:mushrooms},effect={blur:blur,shadow:shadow,radialGradient:radialGradient,clipPath:clipPath},make={bubble:bubble};export{circle,container,create,effect,footer,graticule,halfcircle,header,legend,make,north,outline,path,render,scalebar,spike,text,tile,tool};export default null;
